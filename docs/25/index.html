
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../24/" rel="prev"/>
<link href="../26/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.1.1" name="generator"/>
<title>25 - obsidian-mkdocs template</title>
<link href="../../assets/stylesheets/main.402914a4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.a0c5b2b5.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="pink" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#bookstore_projectsettingspy">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="obsidian-mkdocs template" class="md-header__button md-logo" data-md-component="logo" href="../.." title="obsidian-mkdocs template">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            obsidian-mkdocs template
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              25
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="pink" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="pink" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="obsidian-mkdocs template" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="obsidian-mkdocs template">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    obsidian-mkdocs template
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Obsidian Notes
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Features
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Features
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/LaTeX%20Math%20Support/">
        LaTeX Math Support
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/Mermaid%20Diagrams/">
        Mermaid diagrams
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/Text%20Formatting/">
        Text Formatting
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Topic 1
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Topic 1
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Topic%201/Note%201/">
        Note 1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Topic%201/Note%202/">
        Note 2
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Docs
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Docs
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
        Django
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../00_por_que_django/">
        ¿Por qué Django?
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../01_introduccion/">
        1 Introducción
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../02_configuracion_inicial/">
        2 Configuración inicial
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03_hello_world_app/">
        3. Hello World
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../04_pages_app/">
        4 Pages app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../05_message_board_app/">
        5. Message Board app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../06_blog_app/">
        6. Blog app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../07_formularios/">
        7. Formularios
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../08_cuentas_de_usuarios/">
        8. Cuentas de Usuarios
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../09_modelo_de_usuario_personalizado/">
        9. Modelo de usuario personalizado
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../10_autenticacion_de_usuarios/">
        10. Autenticación de usuarios
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../11_bootstrap/">
        11. Bootstrap
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../12_cambio_y_restauracion_de_contrasenas/">
        12. Cambio y Restauración de Contraseñas
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../13_email/">
        13. Correo electrónico
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../14_newspaper_app/">
        14. Newspaper app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../15_permisos_y_autorizacion/">
        15. Permisos y Autorización
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../16_comentarios/">
        16. Comentarios
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../17_docker/">
        17. Docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../18_postgresql/">
        18. PostgreSQL
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../19_/">
        19. Proyecto Bookstore
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../20_/">
        Chapter 4: Pages App
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../21/">
        21
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../22/">
        22
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../23/">
        23
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../24/">
        24
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<a class="md-nav__link md-nav__link--active" href="./">
        25
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../26/">
        26
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../27/">
        27
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../30/">
        30
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../31/">
        31
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../32/">
        32
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../33/">
        33
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../34/">
        34
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../35/">
        35
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../36/">
        36
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../conclusion/">
        Conclusión
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../correo_en_django/">
        Documentación Django
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../la_api_de_sendgrid/">
        La API de SendGrid
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<p>Chapter 9: Email
In this chapter we will fully configure email and add password change and password
reset functionality. Currently emails are not actually sent to users. They are simply
outputted to our command line console. We’ll change that by signing up for a third-
party email service, obtaining API keys, and updating our settings.py file. Django
takes care of the rest.
So far all of our work–custom user model, pages app, static assets, authentication with
django-allauth, and environment variables–could apply to almost any new project.
After this chapter we will start building out the Bookstore site itself as opposed to
foundational steps.
Custom Confirmation Emails
Let’s sign up for a new user account to review the current user registration flow. Then
we’ll customize it. Make sure you are logged out and then navigate to the Sign Up page.
I’ve chosen to use testuser3@email.com and testpass123 as the password.
Chapter 9: Email
 176
testuser3 Sign Up
Upon submission we are redirected to the homepage with a custom greeting and an
email is sent to us within the command line console. You can see this by checking the
logs with docker-compose logs.
To customize this email we first need to find the existing templates. Navigate over to
the django-allauth source code on Github163 and perform a search with a portion of
the generated text. That leads to the discovery that there are in fact two files used:
one for the subject line, email_confirmation_subject.txt, and one for the email body
called email_confirmation_message.txt.
To update both we’ll override them by recreating the same structure of django-allauth
which means making our own email directory within templates/account and then
adding our own versions of the files there.
163 https://github.com/pennersr/django-allauth
Chapter 9: Email
Command Line
$ mkdir templates/account/email
$ touch templates/account/email/email_confirmation_subject.txt
$ touch templates/account/email/email_confirmation_message.txt
177
Let’s start with the subject line since it’s the shorter of the two. Here is the default
text from django-allauth.
email_confirmation_subject.txt
{% load i18n %}
{% autoescape off %}
{% blocktrans %}Please Confirm Your E-mail Address{% endblocktrans %}
{% endautoescape %}
The first line, {% load i18n %}, is to support Django’s internationalization164 function-
ality, the ability to support multiple languages. Then comes the Django template tag
for autoescape165 . By default it is “on” and protects against security issues like cross
site scripting. But since we can trust the content of the text here, it is turned off.
Finally we come to our text itself which is wrapped in blocktrans166 template tags to
support translations. Let’s change the text to demonstrate that we can.
164 https://docs.djangoproject.com/en/2.2/topics/i18n/
165 https://docs.djangoproject.com/en/2.2/ref/templates/builtins/#autoescape
166 https://docs.djangoproject.com/en/2.2/topics/i18n/translation/#std:templatetag-blocktrans
Chapter 9: Email
 178
email_confirmation_subject.txt
{% load i18n %}
{% autoescape off %}
{% blocktrans %}Confirm Your Sign Up{% endblocktrans %}
{% endautoescape %}
Now turn to the email confirmation message itself. Here is the current default167:
email_confirmation_message.txt
{% load account %}{% user_display user as user_display %}{% load i18n %}
{% autoescape off %}{% blocktrans with site_name=current_site.name\
site_domain=current_site.domain %}Hello from {{ site_name }}!
You're receiving this e-mail because user {{ user_display }} has given yours\
as an e-mail address to connect their account.
To confirm this is correct, go to {{ activate_url }}
{% endblocktrans %}{% endautoescape %}
{% blocktrans with site_name=current_site.name site_domain=current_site.\
domain %}Thank you from {{ site_name }}!
{{ site_domain }}{% endblocktrans %}
You probably noticed that the default email sent referred to our site as example.com
which is displayed here as {{ site_name }}. Where does that come from? The answer
is the sites section of the Django admin, which is used by django-allauth. So head
to the admin at http://127.0.0.1:8000/admin/168 and click on the Sites link on the
homepage.
167 https://github.com/pennersr/django-allauth/blob/41f84f5530b75431cfd4cf2b89cd805ced009e7d/allauth/
templates/account/email/email_confirmation_message.txt
168 http://127.0.0.1:8000/admin/
Chapter 9: Email
 179
Admin Sites
There is a “Domain Name” and a “Display Name” here. Click on example.com under
“Domain Name” so we can edit it.
Admin Change Site
The Domain Name169 is the full domain name for a site, for example it might be
djangobookstore.com, while the Display Name170 is a human-readable name for the
169 https://docs.djangoproject.com/en/2.2/ref/contrib/sites/#django.contrib.sites.models.Site.domain
170 https://docs.djangoproject.com/en/2.2/ref/contrib/sites/#django.contrib.sites.models.Site.name
Chapter 9: Email
 180
site such as Django Bookstore.
Make these updates and click the “Save” button in the lower right corner when done.
Admin Sites - DjangoBookstore.com
Ok, back to our email. Let’s customize it a bit by changing the greeting from “Hello”
to “Hi”. Note that backslashes  are included for formatting but are not necessary in
the raw code. In other words, you can remove them from the code below–and other
code examples–as needed.
email_confirmation_message.txt
{% load account %}{% user_display user as user_display %}{% load i18n %}\
{% autoescape off %}{% blocktrans with site_name=current_site.name
site_domain=current_site.domain %}Hi from {{ site_name }}!
You're receiving this e-mail because user {{ user_display }} has given
yours as an e-mail address to connect their account.
To confirm this is correct, go to {{ activate_url }}
{% endblocktrans %}{% endautoescape %}
{% blocktrans with site_name=current_site.name site_domain=current_site\
Chapter 9: Email
.domain %}Thank you from {{ site_name }}!
{{ site_domain }}{% endblocktrans %}
181
One final item to change. Did you notice the email was from webmaster@localhost?
That’s a default setting we can also update via DEFAULT_FROM_EMAIL171. Let’s do
that now by adding the following line at the bottom of the bookstore_project/settings.py
file.
Code</p>
<h1 id="bookstore_projectsettingspy">bookstore_project/settings.py<a class="headerlink" href="#bookstore_projectsettingspy" title="Permanent link">¶</a></h1>
<p>DEFAULT_FROM_EMAIL = 'admin@djangobookstore.com'
Make sure you are logged out of the site and go to the Sign Up page again to create
a new user. I’ve used testuser4@email.com for convenience. After being redirected to
the homepage check the command line to see the message by typing docker-compose
logs.
Command Line
...
web_1
 | Content-Transfer-Encoding: 7bit
web_1
 | Subject: [Django Bookstore] Confirm Your Sign Up
web_1
 | From: admin@djangobookstore.com
web_1
 | To: testuser4@email.com
web_1
 | Date: Sat, 13 Jul 2019 18:34:50 -0000
web_1
 | Message-ID: <a href="mailto:156312929025.27.2332096239397833769@87d045aff8f7">156312929025.27.2332096239397833769@87d045aff8f7</a>
web_1
 |
web_1
 | Hi from Django Bookstore!
web_1
 |
web_1
 | You're receiving this e-mail because user testuser4 has given yours\
171 https://docs.djangoproject.com/en/2.2/ref/settings/#default-from-email
Chapter 9: Email
 182
as an e-mail address to connect their account.
web_1
 |
web_1
 | To confirm this is correct, go to http://127.0.0.1:8000/accounts/\
confirm-email/NA:1hmjKk:6MiDB5XoLW3HAhePuZ5WucR0Fiw/
web_1
 |
web_1
 | Thank you from Django Bookstore!
web_1
 | djangobookstore.com
And there it is with the new From setting, the new message, and the new domain
djangobookstore.com that sent the email.
Email Confirmation Page
Click on the unique URL link in the email which redirects to the email confirm page.
Confirm Email Page
Not very attractive. Let’s update it to match the look of the rest of our site. Searching
again in the django-allauth source code on Github172 reveals the name and location of
this file is templates/account/email_confirm.html. So let’s create our own template.
172 https://github.com/pennersr/django-allauth
Chapter 9: Email
Command Line
$ touch templates/account/email_confirm.html
And then update it to extend _base.html and use Bootstrap for the button.
Code</p>
<!-- templates/account/email_confirm.html -->
<p>{% extends '_base.html' %}
{% load i18n %}
{% load account %}
{% block head_title %}{% trans "Confirm E-mail Address" %}{% endblock %}
183
{% block content %}</p>
<h1>{% trans "Confirm E-mail Address" %}</h1>
<p>{% if confirmation %}
{% user_display confirmation.email_address.user as user_display %}</p>
<p>{% blocktrans with confirmation.email_address.email as email %}Please confirm
that <a href="mailto:{{ email }}">{{ email }}</a> is an e-mail address for user
{{ user_display }}.{% endblocktrans %}</p>
<form action="{% url 'account_confirm_email' confirmation.key %}" method="post">
{% csrf_token %}
<button class="btn btn-primary" type="submit">{% trans 'Confirm' %}</button>
Chapter 9: Email
 184
</form>
<p>{% else %}
{% url 'account_email' as email_url %}</p>
<p>{% blocktrans %}This e-mail confirmation link expired or is invalid. Please
<a href="{{ email_url }}">issue a new e-mail confirmation request</a>.
{% endblocktrans %}</p>
<p>{% endif %}
{% endblock %}
Refresh the page to see our update.
Confirm Email Page Updated
Chapter 9: Email
 185
Password Reset and Password Change
Django and django-allauth also come with support for additional user account
features such as the ability to reset a forgotten password and change your existing
password if already logged in.
The locations of the default password reset and password change pages are as follows:
• http://127.0.0.1:8000/accounts/password/reset/173
• http://127.0.0.1:8000/accounts/password/change/174
If you go through the flow of each you can find the corresponding templates and email
messages in the django-allauth source code.
Email Service
The emails we have configured so far are generally referred to as “Transactional
Emails” as they occur based on a user action of some kind. This is in contrast to
“Marketing Emails” such as, say, a monthly newsletter.
There are many transactional email providers available including SendGrid, MailGun,
Amazon’s Simple Email Service. Django is agnostic about which provider is used; the
steps are similar for all and many have a free tier available.
After signing up for an account with your email service of choice you’ll often have a
choice between using SMTP175 or a Web API. SMTP is easier to configure, but a web
API is more configurable and robust. Start with SMTP and work your way from there:
email configurations can be quite complex in their own right.
173 http://127.0.0.1:8000/accounts/password/reset/
174 http://127.0.0.1:8000/accounts/password/change/
175 https://en.wikipedia.org/wiki/Simple_Mail_Transfer_Protocol
Chapter 9: Email
 186
After obtaining a username and password with an email provider, a few settings
tweaks will allow Django to use them to send emails.
The first step would be to update the EMAIL_BACKEND config which should be near the
bottom of the bookstore_project/settings.py file since we previously updated it.
Code</p>
<h1 id="bookstore_projectsettingspy_1">bookstore_project/settings.py<a class="headerlink" href="#bookstore_projectsettingspy_1" title="Permanent link">¶</a></h1>
<p>EMAIL_BACKEND = 'django.core.mail.backends.smtp.EmailBackend' # new
And then to configure EMAIL_HOST, EMAIL_HOST_USER, EMAIL_HOST_PASSWORD, EMAIL_PORT,
and EMAIL_USE_TLS based on the instructions from your email provider as environment
variables.
In the official source code the EMAIL_BACKEND will remain console, but the previous
steps are how to add an email service. If you find yourself frustrated properly
configuring email, well, you’re not alone! Django does at least make it far, far easier
than implementing without the benefits of a batteries-included framework.
Implementing email in Django with
Git
To commit this chapter’s code updates make sure to check the status of changes, add
them all, and include a commit message.
Chapter 9: Email
 187
Command Line
$ git status
$ git add .
$ git commit -m 'ch9'
If you have any issues compare your code against the official source code on Github176.
Conclusion
Configuring email properly is largely a one-time pain. But it is a necessary part of
any production website. This concludes the foundational chapters for our Bookstore
project. In the next chapter we’ll finally start building out the Bookstore itself.
176 https://github.com/wsvincent/djangoforprofessionals/tree/master/ch9-email</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.b78d2936.min.js"></script>
<script src="../../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</body>
</html>