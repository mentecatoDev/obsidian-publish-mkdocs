
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../13_email/" rel="prev"/>
<link href="../15_permisos_y_autorizacion/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.1.1" name="generator"/>
<title>14. Newspaper app - obsidian-mkdocs template</title>
<link href="../../assets/stylesheets/main.402914a4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.a0c5b2b5.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="pink" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#14-newspaper-app">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="obsidian-mkdocs template" class="md-header__button md-logo" data-md-component="logo" href="../.." title="obsidian-mkdocs template">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            obsidian-mkdocs template
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              14. Newspaper app
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="pink" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="pink" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="obsidian-mkdocs template" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="obsidian-mkdocs template">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    obsidian-mkdocs template
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Obsidian Notes
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Features
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Features
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/LaTeX%20Math%20Support/">
        LaTeX Math Support
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/Mermaid%20Diagrams/">
        Mermaid diagrams
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/Text%20Formatting/">
        Text Formatting
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Topic 1
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Topic 1
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Topic%201/Note%201/">
        Note 1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Topic%201/Note%202/">
        Note 2
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Docs
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Docs
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
        Django
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../00_por_que_django/">
        ¿Por qué Django?
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../01_introduccion/">
        1 Introducción
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../02_configuracion_inicial/">
        2 Configuración inicial
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03_hello_world_app/">
        3. Hello World
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../04_pages_app/">
        4 Pages app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../05_message_board_app/">
        5. Message Board app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../06_blog_app/">
        6. Blog app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../07_formularios/">
        7. Formularios
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../08_cuentas_de_usuarios/">
        8. Cuentas de Usuarios
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../09_modelo_de_usuario_personalizado/">
        9. Modelo de usuario personalizado
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../10_autenticacion_de_usuarios/">
        10. Autenticación de usuarios
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../11_bootstrap/">
        11. Bootstrap
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../12_cambio_y_restauracion_de_contrasenas/">
        12. Cambio y Restauración de Contraseñas
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../13_email/">
        13. Correo electrónico
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          14. Newspaper app
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        14. Newspaper app
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#141-articles-app">
    14.1. Articles app
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#142-urls-y-vistas">
    14.2. URLs y Vistas
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#143-editarborrar">
    14.3. Editar/Borrar
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#14crear-page">
    14.Crear Page
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#conclusion">
    Conclusión...
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../15_permisos_y_autorizacion/">
        15. Permisos y Autorización
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../16_comentarios/">
        16. Comentarios
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../17_docker/">
        17. Docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../18_postgresql/">
        18. PostgreSQL
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../19_/">
        19. Proyecto Bookstore
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../20_/">
        Chapter 4: Pages App
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../21/">
        21
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../22/">
        22
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../23/">
        23
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../24/">
        24
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../25/">
        25
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../26/">
        26
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../27/">
        27
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../30/">
        30
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../31/">
        31
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../32/">
        32
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../33/">
        33
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../34/">
        34
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../35/">
        35
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../36/">
        36
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../conclusion/">
        Conclusión
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../correo_en_django/">
        Documentación Django
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../la_api_de_sendgrid/">
        La API de SendGrid
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#141-articles-app">
    14.1. Articles app
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#142-urls-y-vistas">
    14.2. URLs y Vistas
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#143-editarborrar">
    14.3. Editar/Borrar
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#14crear-page">
    14.Crear Page
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#conclusion">
    Conclusión...
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="14-newspaper-app">14. Newspaper app<a class="headerlink" href="#14-newspaper-app" title="Permanent link">¶</a></h1>
<p>Habrá una página de artículos en la que los periodistas podrán publicar, establecer permisos para que sólo el autor de un artículo pueda editarlo o borrarlo, y finalmente añadir la posibilidad de que otros usuarios escriban comentarios en cada uno de ellos, lo que introducirá el concepto de <em>claves externas</em>.</p>
<h2 id="141-articles-app">14.1. Articles app<a class="headerlink" href="#141-articles-app" title="Permanent link">¶</a></h2>
<ul>
<li>No hay reglas rígidas sobre cómo llamar a las aplicaciones, excepto que no se puede usar el nombre de una aplicación incorporada.</li>
<li>Una regla general es usar el plural del nombre de una aplicación -<code>posts</code>, <code>payments</code>, <code>users</code>, etc.- a menos que hacerlo sea obviamente incorrecto como en el caso común de <code>blog</code> donde el singular tiene más sentido.</li>
<li>Crear la aplicación para los nuevos artículos.</li>
</ul>
<pre><code class="language-bash">(news) $ python manage.py startapp articles
</code></pre>
<ul>
<li>Añadirla a <code>INSTALLED_APPS</code> y actualizar la <a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones">zona horaria</a> ya que se marcará la hora de los artículos.</li>
<li>Para averiguar la zona horaria correspondiente:</li>
</ul>
<pre><code class="language-python">&gt;&gt;&gt; from pytz import all_timezones, common_timezones
&gt;&gt;&gt; 'Europe/Madrid' in all_timezones
True
</code></pre>
<p>FICHERO: <code>newspaper_project/settings.py</code></p>
<pre><code class="language-python">`...`

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',

    # 3rd Party
    'crispy_forms',

    # Local
    'accounts.apps.AccountsConfig',
    'pages.apps.PagesConfig',
    'articles.apps.ArticlesConfig', # new
]

`...`

TIME_ZONE = 'Europe/Madrid'         # new
</code></pre>
<ul>
<li>Se define el modelo de base de datos con cuatro campos: <code>title</code>, <code>body</code>, <code>date</code>, y <code>author</code>.</li>
<li>Para el campo <code>autor</code> se hará referencia al modelo de usuario personalizado <code>accounts.CustomUser</code> que se ha establecido en el archivo <code>settings.py</code> como <code>AUTH_USER_MODEL</code>. Por lo tanto, si se importa la configuración podemos referirnos a ella como <code>settings.AUTH_USER_MODEL</code> o bien usando el método <code>get_user_model</code>. </li>
<li>También implementamos práctica recomendada de definir un método <code>get_absolute_url</code> desde el principio y un método <code>__str__</code> para ver el modelo en nuestra interfaz de administración.</li>
</ul>
<p>FICHERO: <code>articles/models.py</code></p>
<pre><code class="language-python">from django.contrib.auth import get_user_model
from django.db import models
from django.urls import reverse


class Article(models.Model):
    title = models.CharField(max_length=255, verbose_name='Título')
    body = models.TextField(verbose_name='Cuerpo')
    date = models.DateTimeField(auto_now_add=True, verbose_name='Fecha')
    author = models.ForeignKey(
        get_user_model(),                         # ó settings.AUTH_USER_MODEL,
        on_delete=models.CASCADE,
        verbose_name='Autor'
    )

    def __str__(self):
        return self.title

    def get_absolute_url(self):
        return reverse('article_detail', args=[str(self.id)])
</code></pre>
<ul>
<li>Como se tiene una nueva aplicación y modelo, es hora de hacer un nuevo archivo de migración y luego aplicarlo a la base de datos.</li>
</ul>
<pre><code class="language-bash">(news) $ python manage.py makemigrations articles
(news) $ python manage.py migrate
</code></pre>
<ul>
<li>En este punto es conveniente ir a la administración para jugar con el modelo antes de construir las urls/vistas/plantillas necesarias para mostrar los datos en el sitio web. Pero primero necesitamos actualizar <code>admin.py</code> para que se muestre la nueva aplicación.</li>
</ul>
<p>FICHERO: <code>articles/admin.py</code></p>
<pre><code class="language-python">from django.contrib import admin
from .models import Article


admin.site.register(Article)
</code></pre>
<ul>
<li>Iniciar el servidor, ir a la página de administración y añadir algunos artículos de ejemplo.<ul>
<li>No se podrá añadir la fecha porque fue añadida automáticamente por Django en nuestro nombre y no puede ser cambiada en la administración.</li>
<li>Se podrá hacer que la fecha sea editable -en aplicaciones más complejas es común tener un campo <code>created_at</code> y <code>updated_at</code>- pero para mantener las cosas simples, por ahora sólo se tendrá <code>date</code> establecida por Django al momento de la creación.</li>
</ul>
</li>
</ul>
<h2 id="142-urls-y-vistas">14.2. URLs y Vistas<a class="headerlink" href="#142-urls-y-vistas" title="Permanent link">¶</a></h2>
<ul>
<li>Vamos a hacer que los artículos aparezcan en <code>articles/</code>.</li>
</ul>
<p>FICHERO: <code># newspaper_project/urls.py</code></p>
<pre><code class="language-python">from django.contrib import admin
from django.urls import path, include                       # new

urlpatterns = [
    path('admin/', admin.site.urls),
    path('accounts/', include('accounts.urls')),
    path('accounts/', include('django.contrib.auth.urls')),
    path('articles/', include('articles.urls')),            # new
    path('', include('pages.urls')),
]
</code></pre>
<p>FICHERO: <code>articles/urls.py</code></p>
<pre><code class="language-python">from django.urls import path
from .views import ArticleListView


urlpatterns = [
    path('', ArticleListView.as_view(), name='article_list'),
]
</code></pre>
<ul>
<li>Crear ahora la vista usando la genérica <code>ListView</code> de Django.</li>
</ul>
<p>FICHERO: <code># articles/views.py</code></p>
<pre><code class="language-python">from django.views.generic import ListView
from .models import Article


class ArticleListView(ListView):
    model = Article
    template_name = 'article_list.html'
</code></pre>
<ul>
<li>
<p>Los dos únicos campos que se necesitan especificar son el modelo de artículo y el nombre de la plantilla que será <code>article_list.html</code>.</p>
</li>
<li>
<p>El último paso es crear la plantilla.</p>
</li>
<li>
<p>Bootstrap tiene un componente incorporado llamado <code>Cards</code> que se puede personalizar para los artículos individuales. Recordar que <code>ListView</code> devuelve un objeto llamado object_list que se puede iterar con un bucle for.</p>
</li>
<li>Dentro de cada artículo se muestra el título, el cuerpo, el autor y la fecha. Incluso se proporcionan enlaces a las funciones de "editar" y "borrar" que aún no se han construido.</li>
</ul>
<p>FICHERO: <code>templates/article_list.html</code></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block title %}Articles{% endblock %}

{% block content %}
  {% for article in object_list %}
    &lt;div class="card"&gt;
      &lt;div class="card-header"&gt;
        &lt;span class="font-weight-bold"&gt;{{ article.title }}&lt;/span&gt; &amp;middot;
        &lt;span class="text-muted"&gt;por {{ article.author }} | {{ article.date }}&lt;/span&gt;
      &lt;/div&gt;
      &lt;div class="card-body"&gt;
        {{ article.body }}
      &lt;/div&gt;
      &lt;div class="card-footer text-center text-muted"&gt;
        &lt;a href="#"&gt;Editar&lt;/a&gt; | &lt;a href="#"&gt;Borrar&lt;/a&gt;
      &lt;/div&gt;
    &lt;/div&gt;
    &lt;br&gt;
  {% endfor %}
{% endblock content %}
</code></pre>
<ul>
<li>Arracar el servidor y consultar la página <code>articles/</code></li>
<li>Para más información de personalización consultar el siguiente <a href="https://docs.djangoproject.com/es/3.1/howto/custom-template-tags/">enlace</a></li>
</ul>
<h2 id="143-editarborrar">14.3. Editar/Borrar<a class="headerlink" href="#143-editarborrar" title="Permanent link">¶</a></h2>
<ul>
<li>Se necesitan nuevas urls, vistas y plantillas.</li>
<li>Se puede aprovechar el hecho de que Django añade automáticamente una clave primaria a cada base de datos. Por lo tanto, el primer artículo con una clave primaria de <code>1</code> estará en <code>articles/1/edit/</code> y la ruta de borrado estará en <code>articles/1/delete/</code>.</li>
</ul>
<p>FICHERO: <code>articles/urls.py</code></p>
<pre><code class="language-python">from django.urls import path
from .views import(
    ArticleListView,
    ArticleUpdateView, # new
    ArticleDetailView, # new
    ArticleDeleteView, # new
)

urlpatterns = [
    path('&lt;int:pk&gt;/edit/', ArticleUpdateView.as_view(), name='article_edit'),    # new
    path('&lt;int:pk&gt;/', ArticleDetailView.as_view(), name='article_detail'),       # new
    path('&lt;int:pk&gt;/delete/', ArticleDeleteView.as_view(), name='article_delete'),# new
    path('', ArticleListView.as_view(), name='article_list'),
]
</code></pre>
<ul>
<li>Ahora se escribirán las vistas que usarán las vistas genéricas basadas en clases de Django para <code>DetailView</code>, <code>UpdateView</code> y <code>DeleteView</code>. Especificamos qué campos pueden ser actualizados -<code>title</code> y <code>body</code>- y dónde redirigir al usuario después de borrar un artículo: <code>article_list</code>.</li>
</ul>
<p>FICHERO: <code>articles/views.py</code></p>
<pre><code class="language-python">from django.views.generic import ListView, DetailView
from django.views.generic.edit import UpdateView, DeleteView
from django.urls import reverse_lazy
from .models import Article


class ArticleListView(ListView):
    model = Article
    template_name = 'article_list.html'


class ArticleDetailView(DetailView):
    model = Article
    template_name = 'article_detail.html'


class ArticleUpdateView(UpdateView):
    model = Article
    fields = ['title', 'body', ]
    template_name = 'article_edit.html'


class ArticleDeleteView(DeleteView):
    model = Article
    template_name = 'article_delete.html'
    success_url = reverse_lazy('article_list')
</code></pre>
<ul>
<li>Finalmente se necesita añadir las nuevas plantillas.</li>
</ul>
<pre><code class="language-bash">(news) $ touch templates/article_detail.html
(news) $ touch templates/article_edit.html
(news) $ touch templates/article_delete.html
</code></pre>
<ul>
<li>
<p>Se empezará con la página de detalles que mostrará el título, la fecha, el cuerpo y el autor con enlaces para editar y borrar. También enlazará hacia atrás con todos los artículos.</p>
</li>
<li>
<p>El nombre de la ruta de edición es <code>article_edit</code> y tenemos que pasarle su clave principal <code>article.pk</code>.</p>
</li>
<li>
<p>El nombre de la ruta de borrado es <code>article_delete</code> y también necesita una clave primaria <code>article.pk</code>.</p>
</li>
<li>
<p>La página de artículos es una <code>ListView</code> por lo que no necesita que se le pase ningún argumento adicional.</p>
</li>
</ul>
<p>FICHERO: <code>templates/article_detail.html</code></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block content %}
  &lt;div class="article-entry"&gt;
    &lt;h2&gt;{{ object.title }}&lt;/h2&gt;
      &lt;p&gt;por {{ object.author }} | {{ object.date }}&lt;/p&gt;
      &lt;p&gt;{{ object.body }}&lt;/p&gt;
  &lt;/div&gt;
  &lt;p&gt;&lt;a href="{% url 'article_edit' article.pk %}"&gt;Editar&lt;/a&gt; | &lt;a href="{% url 'article_delete' article.pk %}"&gt;Borrar&lt;/a&gt;&lt;/p&gt;
  &lt;p&gt;Volver a la &lt;a href="{% url 'article_list' %}"&gt;lista de artículos&lt;/a&gt;.&lt;/p&gt;
{% endblock content %}
</code></pre>
<ul>
<li>Para las páginas de edición y borrado se puede usar el estilo del botón de Bootstrap para hacer que el botón de edición sea azul claro y el de borrado rojo.</li>
</ul>
<p>FICHERO: <code>templates/article_edit.html</code></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block content %}
  &lt;h1&gt;Editar&lt;/h1&gt;
  &lt;form action="" method="post"&gt;{% csrf_token %}
    {{ form.as_p }}
    &lt;button class="btn btn-info ml-2" type="submit"&gt;Actualizar&lt;/button&gt;
  &lt;/form&gt;
{% endblock %}
</code></pre>
<p>FICHERO: <code>templates/article_delete.html</code></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block content %}
  &lt;h1&gt;Borrar&lt;/h1&gt;
  &lt;form action="" method="post"&gt;{% csrf_token %}
    &lt;p&gt;¿Estás seguro de que quieres borrar "{{ article.title }}"?&lt;/p&gt;
    &lt;button class="btn btn-danger ml- " type="submit"&gt;Confirmar&lt;/button&gt;
  &lt;/form&gt;
{% endblock %}
</code></pre>
<ul>
<li>Como paso final se añaden los enlaces de edición y borrado a la página de listas en la clase <code>div</code> para el <code>card-foot</code>. Serán los mismos que los añadidos a la página detalle.</li>
</ul>
<p>FICHERO: <code>templates/article_list.html</code></p>
<pre><code class="language-html">`...`
      &lt;div class="card-footer text-center text-muted"&gt;
        &lt;a href="{% url 'article_edit' article.pk %}"&gt;Editar&lt;/a&gt; |
        &lt;a href="{% url 'article_delete' article.pk %}"&gt;Borrar&lt;/a&gt;
      &lt;/div&gt;
`...`
</code></pre>
<ul>
<li>Arrancar el servidor e ir a la página de <code>articles/</code> y pulsar sobre <code>Edit</code>.</li>
<li>Si se actualiza el campo "título" y se hace clic en actualizar, el usuario será redirigido a la página de detalles que mostrará el nuevo cambio.</li>
<li>Si se hace clic en el enlace <code>Delete</code> el usuario será redirigido a la página de borrado.</li>
<li>Si se presiona el aterrador botón rojo <code>Confirm</code> el usuario será redirigido a la página de artículos donde ahora habrá una entrada menos.</li>
</ul>
<h2 id="14crear-page">14.Crear Page<a class="headerlink" href="#14crear-page" title="Permanent link">¶</a></h2>
<p>El paso final es una página de creación de nuevos artículos que podemos hacer con el <code>CreateView</code> de Django. Nuestros tres pasos son crear una vista, una url y una plantilla. Este flujo ya debería resultar bastante familiar. En nuestro archivo de vistas agregamos <code>CreateView</code> a las importaciones de la parte superior y hacemos una nueva clase <code>ArticleCreateView</code> que especifica nuestro modelo, plantilla y los campos disponibles.</p>
<p>FICHERO: <code>articles/views.py</code></p>
<pre><code class="language-python">`...`
from django.views.generic.edit import (
    CreateView,
    UpdateView,
    DeleteView
)
`...`
class ArticleCreateView(CreateView):
    model = Article
    template_name = 'article_new.html'
    fields = ('title', 'body', 'author',)
</code></pre>
<p>Nótese que nuestros campos tienen autor ya que queremos asociar un nuevo artículo con un autor, sin embargo una vez que un artículo ha sido creado no queremos que un usuario pueda cambiar el autor, por lo que ArticleUpdateView sólo tiene los campos ['title', 'body',] .
Actualizar nuestro archivo de urls con la nueva ruta para la vista.</p>
<p>FICHERO: <code>articles/urls.py</code></p>
<pre><code class="language-python">from django.urls import path
from .views import (
    ArticleListView,
    ArticleUpdateView,
    ArticleDetailView,
    ArticleDeleteView,
    ArticleCreateView, # new
)

urlpatterns = [
    path('&lt;int:pk&gt;/edit/', ArticleUpdateView.as_view(), name='article_edit'),
    path('&lt;int:pk&gt;/', ArticleDetailView.as_view(), name='article_detail'),
    path('&lt;int:pk&gt;/delete/',ArticleDeleteView.as_view(), name='article_delete'),
    path('new/', ArticleCreateView.as_view(), name='article_new'), # new
    path('', ArticleListView.as_view(), name='article_list'),
]
</code></pre>
<p>Luego, salga del servidor Control+c para crear una nueva plantilla llamada <code>article_new.html</code>.</p>
<pre><code>(news) $ touch templates/article_new.html
</code></pre>
<p>Y actualizarlo con el siguiente código HTML.</p>
<p>FICHERO: <code>templates/article_new.html</code></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block content %}
    &lt;h1&gt;Nuevo artículo&lt;/h1&gt;
    &lt;form action="" method="post"&gt;{% csrf_token %}
        {{ form.as_p }}
        &lt;button class="btn btn-success ml- " type="submit"&gt;Guardar&lt;/button&gt;
    &lt;/form&gt;
{% endblock content %}
</code></pre>
<p>Como paso final deberíamos añadir un enlace para crear nuevos artículos en nuestro navegador para que sea accesible en todas partes del sitio para los usuarios registrados.</p>
<p>FICHERO: <code>templates/base.html</code></p>
<pre><code class="language-html">&lt;body&gt;
  &lt;nav class="navbar navbar-expand-lg navbar-dark bg-dark"&gt;
    &lt;a class="navbar-brand" href="{% url 'home' %}"&gt;Newspaper&lt;/a&gt;
    {% if user.is_authenticated %}
      &lt;ul class="navbar-nav mr-auto"&gt;
        &lt;li class="nav-item"&gt;
          &lt;a href="{% url 'article_new' %}"&gt;+ Nuevo&lt;/a&gt;
        &lt;/li&gt;
      &lt;/ul&gt;
    {% endif %}
`...`
</code></pre>
<p>¿Y por qué no usar Bootstrap para mejorar nuestra página web original ahora también? Podemos actualizar <code>templates/home.html</code> como sigue.</p>
<p>FICHERO: <code>templates/home.html</code></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block title %}Home{% endblock title %}

{% block content %}
  &lt;br/&gt;
  &lt;div class="jumbotron"&gt;
    &lt;h1 class="display-4"&gt;Newspaper app&lt;/h1&gt;
    &lt;p class="lead"&gt;Un Periódico con Django.&lt;/p&gt;
    &lt;p class="lead"&gt;
      &lt;a class="btn btn-primary btn-lg" href="{% url 'article_list' %}"
      role="button"&gt;Ver los artículos&lt;/a&gt;
    &lt;/p&gt;
  &lt;/div&gt;
{% endblock content %}
</code></pre>
<p>Ya hemos terminado. Vamos a confirmar que todo funciona como se esperaba. Arranca el servidor de nuevo <code>python manage.py runserver</code> y navega a nuestra página web en: http://127.0.0.1:8000/.</p>
<p>Haz clic en el enlace "+ Nuevo" en la parte superior del navegador y serás redirigido a nuestra página de creación.</p>
<p>Adelante, crea un nuevo artículo. Luego haz clic en el botón "Guardar". Serás redirigido a la página de detalles. ¿Por qué? Porque en nuestro archivo <code>models.py</code> establecemos el método <code>get_absolute_url</code> en <code>article_detail</code>. Este es un buen enfoque porque si más tarde cambiamos el patrón de url de la página de detalles a, digamos, <code>articles/details/4/</code> , la redirección seguirá funcionando. Se utilizará cualquier ruta asociada a <code>article_detail</code>; no hay código duro para la ruta en sí misma.</p>
<p>Ten en cuenta también que la clave principal aquí está en el URL. Aunque sólo estamos mostrando tres artículos ahora mismo, Django no reordena las claves primarias sólo porque hayamos borrado una. En la práctica, la mayoría de los sitios del mundo real no borran nada; en su lugar, "ocultan" los campos borrados, ya que esto facilita el mantenimiento de la integridad de una base de datos y da la opción de "recuperar" más adelante si es necesario. Con nuestro enfoque actual, una vez que algo se borra, ¡se va para siempre!
Haga clic en el enlace de "Todos los artículos" para ver nuestra nueva página de artículos.</p>
<p>Hay un nuevo artículo en la parte inferior, como se esperaba.</p>
<h2 id="conclusion">Conclusión...<a class="headerlink" href="#conclusion" title="Permanent link">¶</a></h2>
<p>Hemos creado una aplicación de artículos dedicados con la funcionalidad de CRUD. Pero aún no hay permisos o autorizaciones, lo que significa que cualquiera puede hacer cualquier cosa. Un usuario desconectado puede visitar todas las URLs y cualquier usuario conectado puede editar o eliminar un artículo existente, ¡incluso uno que no sea suyo! En el próximo capítulo añadiremos permisos y autorizaciones a nuestro proyecto para arreglar esto.</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.b78d2936.min.js"></script>
<script src="../../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</body>
</html>