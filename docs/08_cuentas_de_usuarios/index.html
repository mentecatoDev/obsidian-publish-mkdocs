
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../07_formularios/" rel="prev"/>
<link href="../09_modelo_de_usuario_personalizado/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.1.1" name="generator"/>
<title>8. Cuentas de Usuarios - obsidian-mkdocs template</title>
<link href="../../assets/stylesheets/main.402914a4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.a0c5b2b5.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="pink" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#8-cuentas-de-usuarios">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="obsidian-mkdocs template" class="md-header__button md-logo" data-md-component="logo" href="../.." title="obsidian-mkdocs template">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            obsidian-mkdocs template
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              8. Cuentas de Usuarios
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="pink" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="pink" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="obsidian-mkdocs template" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="obsidian-mkdocs template">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    obsidian-mkdocs template
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Obsidian Notes
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Features
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Features
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/LaTeX%20Math%20Support/">
        LaTeX Math Support
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/Mermaid%20Diagrams/">
        Mermaid diagrams
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/Text%20Formatting/">
        Text Formatting
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Topic 1
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Topic 1
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Topic%201/Note%201/">
        Note 1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Topic%201/Note%202/">
        Note 2
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Docs
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Docs
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
        Django
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../00_por_que_django/">
        ¿Por qué Django?
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../01_introduccion/">
        1 Introducción
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../02_configuracion_inicial/">
        2 Configuración inicial
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03_hello_world_app/">
        3. Hello World
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../04_pages_app/">
        4 Pages app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../05_message_board_app/">
        5. Message Board app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../06_blog_app/">
        6. Blog app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../07_formularios/">
        7. Formularios
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          8. Cuentas de Usuarios
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        8. Cuentas de Usuarios
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#81-login">
    8.1. Login
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#82-actualizado-de-la-homepage">
    8.2. Actualizado de la homepage
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#83-enlace-para-logout">
    8.3. Enlace para Logout
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#84-inscripcion">
    8.4. Inscripción
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#85-git">
    8.5. Git
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#86-configuracion-de-heroku">
    8.6. Configuración de Heroku
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#87-despliegue-en-heroku">
    8.7. Despliegue en Heroku
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#88-conclusion">
    8.8. Conclusión
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../09_modelo_de_usuario_personalizado/">
        9. Modelo de usuario personalizado
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../10_autenticacion_de_usuarios/">
        10. Autenticación de usuarios
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../11_bootstrap/">
        11. Bootstrap
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../12_cambio_y_restauracion_de_contrasenas/">
        12. Cambio y Restauración de Contraseñas
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../13_email/">
        13. Correo electrónico
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../14_newspaper_app/">
        14. Newspaper app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../15_permisos_y_autorizacion/">
        15. Permisos y Autorización
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../16_comentarios/">
        16. Comentarios
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../17_docker/">
        17. Docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../18_postgresql/">
        18. PostgreSQL
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../19_/">
        19. Proyecto Bookstore
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../20_/">
        Chapter 4: Pages App
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../21/">
        21
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../22/">
        22
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../23/">
        23
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../24/">
        24
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../25/">
        25
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../26/">
        26
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../27/">
        27
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../30/">
        30
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../31/">
        31
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../32/">
        32
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../33/">
        33
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../34/">
        34
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../35/">
        35
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../36/">
        36
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../conclusion/">
        Conclusión
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../correo_en_django/">
        Documentación Django
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../la_api_de_sendgrid/">
        La API de SendGrid
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#81-login">
    8.1. Login
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#82-actualizado-de-la-homepage">
    8.2. Actualizado de la homepage
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#83-enlace-para-logout">
    8.3. Enlace para Logout
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#84-inscripcion">
    8.4. Inscripción
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#85-git">
    8.5. Git
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#86-configuracion-de-heroku">
    8.6. Configuración de Heroku
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#87-despliegue-en-heroku">
    8.7. Despliegue en Heroku
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#88-conclusion">
    8.8. Conclusión
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="8-cuentas-de-usuarios">8. Cuentas de Usuarios<a class="headerlink" href="#8-cuentas-de-usuarios" title="Permanent link">¶</a></h1>
<ul>
<li>La mayoría de las aplicaciones web cuentan con una importante pieza: la <strong>autenticación del usuario</strong>.</li>
<li>La implementación de una autenticación de usuario adecuada es conocida por su dificultad</li>
<li>Afortunadamente Django viene con un poderoso sistema de autenticación de usuarios <strong>incorporado</strong>.</li>
<li>
<p>Cada vez que se crea un nuevo proyecto, Django instala por defecto la aplicación de autenticación, que proporciona un objeto de usuario que contiene:</p>
</li>
<li>
<p>Nombre de Usuario</p>
</li>
<li>Contraseña</li>
<li>Correo Electrónico</li>
<li>Nombre</li>
<li>Apellidos</li>
</ul>
<h2 id="81-login">8.1. Login<a class="headerlink" href="#81-login" title="Permanent link">¶</a></h2>
<ul>
<li>
<p>Se usará este objeto usuario para implementar:</p>
</li>
<li>
<p>El inicio de sesión</p>
</li>
<li>El cierre de sesión</li>
<li>
<p>El registro en la aplicación del blog</p>
</li>
<li>
<p>Django proporciona una vista predeterminada para una página de inicio de sesión a través de <code>LoginView</code>.</p>
</li>
<li>
<p>Todo lo que se necesita es:</p>
<ul>
<li>Añadir un patrón de url a nivel de proyecto para el sistema de autorización</li>
<li>Una plantilla de inicio de sesión</li>
<li>Una pequeña actualización del fichero <code>settings.py</code></li>
</ul>
</li>
<li>
<p>Actualizar el archivo <code>urls.py</code> a nivel de proyecto</p>
</li>
<li>Se colocaran las páginas de <em>login</em> y <em>logout</em> en la URL <code>accounts/</code>.</li>
</ul>
<p>FICHERO: <code>blog_project/urls.py</code></p>
<pre><code class="language-python">from django.contrib import admin
from django.urls import path, include


urlpatterns = [
    path('admin/', admin.site.urls),
    path('accounts/', include('django.contrib.auth.urls')), # new
    path('', include('blog.urls')),
]
</code></pre>
<ul>
<li>Como se indica en la documentación de <code>LoginView</code>, por defecto Django buscará dentro de una carpeta de plantillas llamada <code>registration</code> un archivo llamado <code>login.html</code> para un formulario de inicio de sesión. Así que tenemos que crear un nuevo directorio llamado <code>registration</code> y el archivo requerido dentro de él.</li>
</ul>
<pre><code class="language-bash">(blog) $ mkdir templates/registration
(blog) $ touch templates/registration/login.html
</code></pre>
<p>FICHERO: <code>templates/registration/login.html</code></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block content %}
&lt;h2&gt;Login&lt;/h2&gt;
&lt;form method="post"&gt;
  {% csrf_token %}
  {{ form.as_p }}
  &lt;button type="submit"&gt;Login&lt;/button&gt;
&lt;/form&gt;
{% endblock content %}
</code></pre>
<ul>
<li>Se usan las etiquetas HTML <form></form> con el método POST ya que se está enviando datos al servidor (se usa GET si se están solicitando datos, como en un formulario de un motor de búsqueda). Se añade <code>{% csrf_token %}</code> por motivos de seguridad, es decir, para evitar ataques XSS. El contenido del formulario se muestra entre las etiquetas de los párrafos gracias a <code>{{ form.as_p }}</code> y luego se añade un botón "enviar" (<code>submit</code>).</li>
<li>En el paso final hay que especificar dónde redirigir al usuario cuando el acceso es exitoso. Podemos establecer esto con la configuración <code>LOGIN_REDIRECT_URL</code>. En la parte inferior del archivo <code>settings.py</code> agregar:
  FICHERO: <code>settings.py</code></li>
</ul>
<pre><code class="language-python">LOGIN_REDIRECT_URL = 'home'
</code></pre>
<ul>
<li>
<p>Ahora el usuario será redirigido a la plantilla <code>home</code> que es la página de inicio.
  Navegar ahora a: http://127.0.0.1:8000/accounts/login/</p>
</li>
<li>
<p>Al introducir la información de acceso de la cuenta de superusuario, seremos redirigidos a la página de inicio.</p>
</li>
<li>Nótese que no se ha añadido ninguna lógica de visualización ni se ha creado un modelo de base de datos porque el sistema de autentificación de Django los proporcionó automáticamente.</li>
</ul>
<h2 id="82-actualizado-de-la-homepage">8.2. Actualizado de la homepage<a class="headerlink" href="#82-actualizado-de-la-homepage" title="Permanent link">¶</a></h2>
<ul>
<li>Actualizar la plantilla <code>base.html</code> para mostrar un mensaje a los usuarios tanto si están conectados como si no.</li>
<li>Se puede usar el atributo <code>is_authenticated</code> para esto.</li>
<li>Por ahora, se pondrá este código en una posición preeminente. Más adelante se le podrá dar un estilo más apropiado.</li>
</ul>
<p>FICHERO: <code>templates/base.html</code></p>
<pre><code class="language-html">...
&lt;/header&gt;
{% if user.is_authenticated %}
  &lt;p&gt;¡Hola {{ user.username }}!&lt;/p&gt;
{% else %}
  &lt;p&gt;No estás logueado&lt;/p&gt;
  &lt;a href="{% url 'login' %}"&gt;login&lt;/a&gt;
{% endif %}
{% block content %}
{% endblock content %}
</code></pre>
<ul>
<li>Si el usuario está conectado, se le saludará por su nombre, si no,  se le dará un enlace a la recién creada página de acceso.</li>
</ul>
<h2 id="83-enlace-para-logout">8.3. Enlace para Logout<a class="headerlink" href="#83-enlace-para-logout" title="Permanent link">¶</a></h2>
<ul>
<li>Se añade un enlace de cierre de sesión que redirija a la página de inicio.</li>
<li>Gracias al sistema de autentificación de Django, esto es muy sencillo de conseguir.</li>
<li>En el archivo <code>base.html</code> se agrega un enlace de una línea <code>{% url 'logout' %}</code> para desconectarse.</li>
</ul>
<p>FICHERO: <code>templates/base.html</code></p>
<pre><code class="language-html">...
{% if user.is_authenticated %}
  &lt;p&gt;¡Hola {{ user.username }}!&lt;/p&gt;
  &lt;p&gt;&lt;a href="{% url 'logout' %}"&gt;logout&lt;/a&gt;&lt;/p&gt;
{% else %}
...
</code></pre>
<ul>
<li>Eso es todo lo que se necesita hacer ya que la vista necesaria proporciona una app de autenticación <code>auth</code>. Aún se necesita especificar dónde redirigir al usuario al cerrar la sesión.</li>
<li>Actualizar <code>settings.py</code> para proporcionar un enlace de redireccionamiento que se llama, apropiadamente, <code>LOGOUT_REDIRECT_URL</code>. Podemos añadirlo justo al lado de nuestra redirección de inicio de sesión, de manera que la parte inferior del archivo tenga el siguiente aspecto:</li>
</ul>
<p>FICHERO: <code>blog_project/settings.py</code></p>
<pre><code class="language-python">LOGIN_REDIRECT_URL = 'home'
LOGOUT_REDIRECT_URL = 'home'
</code></pre>
<h2 id="84-inscripcion">8.4. Inscripción<a class="headerlink" href="#84-inscripcion" title="Permanent link">¶</a></h2>
<p>Se necesita escribir una vista propia para la página de registro de nuevos usuarios, pero Django  proporciona una clase formulario, <code>UserCreationForm</code>, para facilitar las cosas. </p>
<blockquote>
<p>Por defecto viene con tres campos: nombre de usuario, contraseña y contraseña.</p>
</blockquote>
<p>Hay muchas maneras de organizar el código y la estructura de las urls para un sistema de autenticación de usuario robusto. Aquí se creará una nueva aplicación dedicada, <code>accounts</code>, para la página de registro.</p>
<pre><code class="language-bash">(blog) $ python manage.py startapp accounts
</code></pre>
<ul>
<li>Añadir la nueva app a INSTALLED_APPS del fichero <code>settings.py</code>.
FICHERO: <code>blog_project/settings.py</code></li>
</ul>
<pre><code class="language-python">INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'blog.apps.BlogConfig',
    'accounts.apps.AccountsConfig',
]
</code></pre>
<ul>
<li>A continuación añadimos una url a nivel de proyecto que apunta a esta nueva aplicación directamente debajo de donde incluimos la aplicación de autorización incorporada.
FICHERO: <code>blog_project/urls.py</code></li>
</ul>
<pre><code class="language-python">from django.contrib import admin
from django.urls import path, include


urlpatterns = [
    path('admin/', admin.site.urls),
    path('accounts/', include('django.contrib.auth.urls')),
    path('accounts/', include('accounts.urls')),            # new
    path('', include('blog.urls')),
]
</code></pre>
<ul>
<li>El orden de las <code>urls</code> importa porque Django lee este archivo de arriba a abajo. Por lo tanto, cuando se solicite la url <code>/accounts/signup</code>, Django buscará primero en el archivo <code>auth</code>, no lo encontrará, y luego procederá a la aplicación <code>accounts</code> de cuentas.</li>
</ul>
<pre><code class="language-bash">(blog) $ touch accounts/urls.py
</code></pre>
<p>...y añade el siguiente código:
FICHERO: <code>accounts/urls.py</code></p>
<pre><code class="language-python">from django.urls import path
from . import views


urlpatterns = [
    path('signup/', views.SignUpView.as_view(), name='signup'),
]
</code></pre>
<ul>
<li>Se está usando una vista que aún no se ha creado llamada  <code>SignupView</code> que está basada en clases, ya que está en mayúsculas, y tiene el sufijo <code>as_view()</code>. Su ruta es sólo <code>signup/</code> por lo que la ruta general será <code>accounts/signup/</code>.</li>
<li>Ahora para la vista que usa el <code>UserCreationForm</code> incorporado y el <code>CreateView</code> genérico .
FICHERO: <code>accounts/views.py</code></li>
</ul>
<pre><code class="language-python">from django.contrib.auth.forms import UserCreationForm
from django.urls import reverse_lazy
from django.views.generic import CreateView


class SignUpView(CreateView):
    form_class = UserCreationForm
    success_url = reverse_lazy('login')
    template_name = 'signup.html'
</code></pre>
<ul>
<li>Se está heredando de la vista genérica basada en clases <code>CreateView</code> la clase <code>SignUpView</code>. Se especifica el uso del <code>UserCreationForm</code> incorporado y la plantilla, aún no creada,  <code>signup.html</code>. Y se usa <code>reverse_lazy</code> para redirigir al usuario a la página de inicio de sesión cuando se registra con éxito.</li>
<li>¿Por qué usar aquí <code>reverse_lazy</code> en lugar de <code>reverse</code>? La razón es que para todas las vistas genéricas basadas en clases las urls no se cargan cuando se importa el archivo, por lo que tenemos que usar la forma perezosa de <code>reverse</code> para cargarlas más tarde cuando estén disponibles.</li>
<li>Añadir <code>signup.html</code> a la carpeta de plantillas a nivel de proyecto:</li>
</ul>
<pre><code class="language-bash">(blog) $ touch templates/signup.html
</code></pre>
<p>TEMPLATE: <code>templates/signup.html</code></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block content %}
  &lt;h2&gt;Sign up&lt;/h2&gt;
  &lt;form method="post"&gt;
    {% csrf_token %}
    {{ form.as_p }}
    &lt;button type="submit"&gt;Sign up&lt;/button&gt;
  &lt;/form&gt;
{% endblock %}
</code></pre>
<ul>
<li>Al principio se extiende la plantilla base, se coloca la lógica entre las etiquetas <code>&lt;form&gt;&lt;/form&gt;</code>, y se usa <code>csrf_token</code> por seguridad. El contenido del formulario se muestra en etiquetas de párrafo con <code>form.as_p</code> y se incluye un botón de envío.</li>
<li>Navegar en: http://127.0.0.1:8000/accounts/signup/</li>
<li>Observar que hay mucho texto extra que Django incluye por defecto. Se puede personalizar usando el <em>marco de mensajes</em> incorporado, pero por ahora probar el formulario.</li>
<li>Crear un nuevo usuario llamado "William" y comprobar como al enviarlo se redirige a la página de acceso y de como, después de ingresar exitosamente, se redirige a la página de inicio con el saludo personalizado <code>Hola William</code>.</li>
<li>El último flujo es, por lo tanto:</li>
</ul>
<p><center>Inscripción (Signup) -&gt; Inicio de sesión (Login) -&gt; Página de inicio (Homepage)</center>
- Y por supuesto podemos modificar esto como queramos. La <code>SignupView</code> se redirige a la entrada al sistema (login) porque se establece <code>success_url = reverse_lazy('login')</code>. La página de <em>login</em> se redirige a la <em>homepage</em> porque en el archivo <code>settings.py</code> se establece <code>LOGIN_REDIRECT_URL = 'home'</code>.</p>
<blockquote>
<p>Al principio puede parecer abrumador llevar la cuenta de todas las partes de un proyecto Django. Eso es normal. Con el tiempo empezarán a tener más sentido.</p>
</blockquote>
<h2 id="85-git">8.5. Git<a class="headerlink" href="#85-git" title="Permanent link">¶</a></h2>
<pre><code class="language-bash">(blog) $ git commit -m 'Añade formulario para crear cuentas de usuario'
</code></pre>
<p>Crear un nuevo repo en GitHub al que se puede llamar como se desee.</p>
<pre><code class="language-bash">(blog) $ git remote add origin https://github.com/mentecatoDev/blog.git
(blog) $ git branch -M main
(blog) $ git push -u origin main
</code></pre>
<h2 id="86-configuracion-de-heroku">8.6. Configuración de Heroku<a class="headerlink" href="#86-configuracion-de-heroku" title="Permanent link">¶</a></h2>
<ul>
<li>Hay cuatro cambios que hacer para el despliegue en Heroku.</li>
<li>actualizar <code>Pipfile.lock</code></li>
<li>nuevo <code>Procfile</code></li>
<li>instalar <code>gunicorn</code></li>
<li>actualizar <code>settings.py</code></li>
</ul>
<p>FICHERO: <code>Pipfile</code></p>
<pre><code class="language-pipfile">[requires]
python_version = "3.9"
</code></pre>
<pre><code class="language-bash">(blog) $ pipenv lock
</code></pre>
<pre><code class="language-bash">(blog) $ touch Procfile
</code></pre>
<p>FICHERO: <code>Procfile</code></p>
<pre><code>web: gunicorn blog_project.wsgi --log-file -
</code></pre>
<pre><code class="language-bash">(blog) $ pipenv install gunicorn
</code></pre>
<p>FICHERO: <code>blog_project/settings.py</code></p>
<pre><code class="language-python">ALLOWED_HOSTS = ['*']
</code></pre>
<pre><code class="language-bash">(blog) $ git status
(blog) $ git add -A
(blog) $ git commit -m 'Añade ficheros de configuración Heroku'
(blog) $ git push -u origin main
</code></pre>
<h2 id="87-despliegue-en-heroku">8.7. Despliegue en Heroku<a class="headerlink" href="#87-despliegue-en-heroku" title="Permanent link">¶</a></h2>
<pre><code class="language-bash">(blog) $ heroku login
</code></pre>
<ul>
<li>"Create" indica a Heroku que haga un nuevo contenedor para la aplicación. Si sólo se ejecuta <code>heroku create</code>, Heroku asignará un nombre al azar, aunque se puede especificar un nombre personalizado, que debe ser único en Heroku.</li>
</ul>
<pre><code class="language-bash">(blog) $ heroku create dfb-blog
</code></pre>
<ul>
<li>Ahora configurar git de manera que cuando se suba a Heroku (push), vaya al nombre de la nueva aplicación (reemplazar <code>dfb-blog</code> con el nombre elegido).</li>
</ul>
<pre><code class="language-bash">(blog) $ heroku git:remote -a dfb-blog
</code></pre>
<ul>
<li>Hay un paso más que debemos dar ahora que tenemos archivos estáticos, en este caso CSS. Django no soporta servir archivos estáticos en producción, sin embargo el proyecto <code>WhiteNoise</code> sí lo hace. Así que vamos a instalarlo.</li>
</ul>
<pre><code class="language-bash">(blog) $ pipenv install whitenoise
</code></pre>
<ul>
<li>Hay que actualizar la configuración estática para que se use en producción. En el editor de texto abrir <code>settings.py</code> . Añadir <code>whitenoise</code> a <code>INSTALLED_APPS</code> encima de la aplicación de archivos estáticos incorporada y también a <code>MIDDLEWARE</code> en la tercera línea. El orden importa tanto para <code>INSTALLED_APPS</code> como para <code>MIDDLEWARE</code>.
  En la parte inferior del archivo añadir nuevas líneas tanto para <code>STATIC_ROOT</code> como para <code>STATICFILES_STORAGE</code>. Debería verse lo siguiente:</li>
</ul>
<p>FICHERO: <code>blog_project/settings.py</code></p>
<pre><code class="language-python">INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'whitenoise.runserver_nostatic',                            # new!
    'django.contrib.staticfiles',
    'blog',
    'accounts',
]
MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'whitenoise.middleware.WhiteNoiseMiddleware',               # new!
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]
...
STATIC_ROOT = str(BASE_DIR.joinpath('staticfiles')) # new!
STATIC_URL = '/static/'
STATICFILES_DIRS = [str(BASE_DIR.joinpath('static'))]
STATICFILES_STORAGE = 'whitenoise.storage.CompressedManifestStaticFilesStorage' # new!
</code></pre>
<pre><code class="language-bash">(blog) $ git add -A
(blog) $ git commit -m 'Heroku config'
(blog) $ git push origin master
</code></pre>
<p>Finalmente podemos subir el código a Heroku y añadir un proceso web para que el banco de pruebas se ponga en marcha.</p>
<pre><code class="language-bash">(blog) $ git push heroku master
(blog) $ heroku ps:scale web=1
</code></pre>
<h2 id="88-conclusion">8.8. Conclusión<a class="headerlink" href="#88-conclusion" title="Permanent link">¶</a></h2>
<p>Con una mínima cantidad de código, el framework de Django nos ha permitido crear un flujo de autenticación de usuario de inicio de sesión, cierre de sesión y registro. Entre bambalinas, se han cubierto muchos problemas de seguridad que pueden surgir si se intenta crear un flujo de autenticación de usuario propio desde cero.</p>
<p>|\/| [- || <sub>|</sub> [- ( / <sub>|</sub> () ^/_ '|</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.b78d2936.min.js"></script>
<script src="../../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</body>
</html>