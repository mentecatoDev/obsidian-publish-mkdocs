
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../06_blog_app/" rel="prev"/>
<link href="../08_cuentas_de_usuarios/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.1.1" name="generator"/>
<title>7. Formularios - obsidian-mkdocs template</title>
<link href="../../assets/stylesheets/main.402914a4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.a0c5b2b5.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="pink" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#7-formularios">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="obsidian-mkdocs template" class="md-header__button md-logo" data-md-component="logo" href="../.." title="obsidian-mkdocs template">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            obsidian-mkdocs template
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              7. Formularios
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="pink" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="pink" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="obsidian-mkdocs template" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="obsidian-mkdocs template">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    obsidian-mkdocs template
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Obsidian Notes
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Features
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Features
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/LaTeX%20Math%20Support/">
        LaTeX Math Support
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/Mermaid%20Diagrams/">
        Mermaid diagrams
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/Text%20Formatting/">
        Text Formatting
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Topic 1
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Topic 1
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Topic%201/Note%201/">
        Note 1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Topic%201/Note%202/">
        Note 2
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Docs
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Docs
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
        Django
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../00_por_que_django/">
        ¿Por qué Django?
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../01_introduccion/">
        1 Introducción
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../02_configuracion_inicial/">
        2 Configuración inicial
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03_hello_world_app/">
        3. Hello World
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../04_pages_app/">
        4 Pages app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../05_message_board_app/">
        5. Message Board app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../06_blog_app/">
        6. Blog app
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<label class="md-nav__link md-nav__link--active" for="__toc">
          7. Formularios
          <span class="md-nav__icon md-icon"></span>
</label>
<a class="md-nav__link md-nav__link--active" href="./">
        7. Formularios
      </a>
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#71-formularios">
    7.1 Formularios
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#72-actualizar-formularios">
    7.2 Actualizar Formularios
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#73-borrar-la-vista">
    7.3 Borrar la vista
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#74-tests">
    7.4 Tests
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#75-conclusion">
    7.5 Conclusión
  </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../08_cuentas_de_usuarios/">
        8. Cuentas de Usuarios
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../09_modelo_de_usuario_personalizado/">
        9. Modelo de usuario personalizado
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../10_autenticacion_de_usuarios/">
        10. Autenticación de usuarios
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../11_bootstrap/">
        11. Bootstrap
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../12_cambio_y_restauracion_de_contrasenas/">
        12. Cambio y Restauración de Contraseñas
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../13_email/">
        13. Correo electrónico
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../14_newspaper_app/">
        14. Newspaper app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../15_permisos_y_autorizacion/">
        15. Permisos y Autorización
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../16_comentarios/">
        16. Comentarios
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../17_docker/">
        17. Docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../18_postgresql/">
        18. PostgreSQL
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../19_/">
        19. Proyecto Bookstore
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../20_/">
        Chapter 4: Pages App
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../21/">
        21
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../22/">
        22
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../23/">
        23
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../24/">
        24
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../25/">
        25
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../26/">
        26
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../27/">
        27
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../30/">
        30
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../31/">
        31
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../32/">
        32
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../33/">
        33
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../34/">
        34
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../35/">
        35
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../36/">
        36
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../conclusion/">
        Conclusión
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../correo_en_django/">
        Documentación Django
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../la_api_de_sendgrid/">
        La API de SendGrid
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
<label class="md-nav__title" for="__toc">
<span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
<ul class="md-nav__list" data-md-component="toc" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="#71-formularios">
    7.1 Formularios
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#72-actualizar-formularios">
    7.2 Actualizar Formularios
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#73-borrar-la-vista">
    7.3 Borrar la vista
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#74-tests">
    7.4 Tests
  </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="#75-conclusion">
    7.5 Conclusión
  </a>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<h1 id="7-formularios">7. Formularios<a class="headerlink" href="#7-formularios" title="Permanent link">¶</a></h1>
<ul>
<li>Se va a seguir trabajando sobre la aplicación Blog añadiendo Formularios para poder crear, editar y/o borrar cualquiera de las entradas.</li>
</ul>
<h2 id="71-formularios">7.1 Formularios<a class="headerlink" href="#71-formularios" title="Permanent link">¶</a></h2>
<ul>
<li>Los formularios son muy comunes y difíciles de implementar correctamente.</li>
<li>Cada vez que se acepta la entrada de un usuario hay preocupaciones de:<ul>
<li><strong>Seguridad</strong> (<a href="https://es.wikipedia.org/wiki/Cross-site_scripting">Ataques XSS <em>Cross-Site Scripting</em></a>)</li>
<li>Se requiere un <strong>manejo</strong> adecuado de los <strong>errores</strong></li>
<li>Hay <strong>consideraciones de UI</strong> sobre cómo alertar al usuario de problemas con el formulario.</li>
<li>Sin mencionar la necesidad de <strong>redireccionarlo</strong> en caso de <strong>éxito</strong>.</li>
</ul>
</li>
<li>
<p>Afortunadamente, los formularios incorporados de Django abstraen gran parte de la dificultad y proporcionan un rico conjunto de herramientas para manejar los casos de uso común para trabajar con los formularios.</p>
</li>
<li>
<p>Actualizar la plantilla base para mostrar un enlace a una página donde introducir nuevas entradas en el blog. Tomará la forma <code>&lt;a href="{% url 'post_new' %}"&gt;&lt;a/&gt;</code> donde <code>post_new</code> es el nombre de la URL.</p>
</li>
</ul>
<p>FICHERO: <code>templates/base.html</code></p>
<pre><code class="language-html">{% load static %}
&lt;html lang="es"&gt;
  &lt;head&gt;
    &lt;title&gt;Django Blog&lt;/title&gt;
    &lt;link href="https://fonts.googleapis.com/css?family=\
Source+Sans+Pro:400" rel="stylesheet"&gt;
&lt;link href="{% static 'css/base.css' %}" rel="stylesheet"&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;div&gt;
      &lt;header&gt;
        &lt;div class="nav-left"&gt;
            &lt;h1&gt;&lt;a href="{% url 'home' %}"&gt;Django Blog&lt;/a&gt;&lt;/h1&gt;
        &lt;/div&gt;
        &lt;div class="nav-right"&gt;
            &lt;a href="{% url 'post_new' %}"&gt;+ Nuevo Blog Post&lt;/a&gt;
        &lt;/div&gt;
      &lt;/header&gt;
      {% block content %}
      {% endblock content %}
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</code></pre>
<p>FICHERO: <code>blog/urls.py</code></p>
<pre><code class="language-python">from django.urls import path
from .views import BlogListView, BlogDetailView, BlogCreateView # new

urlpatterns = [
    path('post/new/', BlogCreateView.as_view(), name='post_new'), # new
    path('post/&lt;int:pk&gt;/', BlogDetailView.as_view(), name='post_detail'),
    path('', BlogListView.as_view(), name='home'),
]
</code></pre>
<ul>
<li>La url empezará con <code>post/new/</code>, la vista se llama <code>BlogCreateView</code>, y la url se llamará <code>post_new</code>.</li>
<li>Crear la vista importando una nueva clase genérica llamada <code>CreateView</code> y luego heredarla para crear una nueva vista llamada <code>BlogCreateView</code>.</li>
</ul>
<p>FICHERO: <code>blog/views.py</code></p>
<pre><code class="language-python">from django.views.generic import ListView, DetailView
from django.views.generic.edit import CreateView
from . models import Post


class BlogListView(ListView):
    model = Post
    template_name = 'home.html'


class BlogDetailView(DetailView):
    model = Post
    template_name = 'post_detail.html'


class BlogCreateView(CreateView): # new
    model = Post
    template_name = 'post_new.html'
    fields = ['title', 'author', 'body']   # ó fields = '__all__'

</code></pre>
<ul>
<li>Dentro de <code>BlogCreateView</code> se especifica el modelo de base de datos <code>Post</code>, el nombre de la plantilla <code>post_new.html</code>, y los campos  <code>title</code> ,  <code>author</code> y <code>body</code>. También puede usarse la fómula  <code>'__all__'</code>  para especificar todos los campos.</li>
<li>El último paso es crear la plantilla, que llamaremos <code>post_new.html</code>.</li>
</ul>
<pre><code class="language-bash">(blog) $ touch templates/post_new.html
</code></pre>
<p>FICHERO: <code>templates/post_new.html</code></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block content %}
    &lt;h1&gt;Nuevo post&lt;/h1&gt;
    &lt;form action="" method="post"&gt;
        {% csrf_token %}
        {{ form.as_p }}
        &lt;input type="submit" value="Guardar"/&gt;
    &lt;/form&gt;
{% endblock content%}
</code></pre>
<ul>
<li>En la línea superior se hereda la plantilla base.</li>
<li>Se usan etiquetas HTML <code>&lt;form&gt;</code> con el método POST ya que se está enviando datos. Si se reciben datos desde un formulario, por ejemplo en un cuadro de búsqueda, se utilizaría GET.</li>
<li>Se añade un <code>{% csrf_token %}</code> que proporciona Django <strong>para proteger al formulario de ataques de cross-site scripting</strong>. <u>Se debe usar en todos los formularios de Django</u>.</li>
<li>Luego para obtener los datos del formulario se usa <code>{{ form.as_p }}</code> que lo renderiza dentro de etiquetas de párrafo <code>&lt;p&gt;</code>.</li>
<li>Por último, se especifica un <code>input type="submit"</code> con el valor "Guardar".</li>
<li>
<p>Iniciar el servidor con <code>python manage.py runserver</code> e ir a la página web en http://127.0.0.1:8000</p>
</li>
<li>
<p>Hacer clic en el enlace para "+ Nuevo Blog Post" que le redirigirá a:
  http://127.0.0.1:8000/post/new/.</p>
</li>
<li>Crear una nueva entrada de blog.</li>
<li>¡Ups! ¿Qué ha pasado?</li>
<li>En el mensaje de error Django se queja de que no se especificó dónde enviar al usuario después de haber enviado el formulario con éxito.</li>
<li>Se enviará al usuario a la página de detalles después de haber tenido éxito; así se podrá ver el mensaje completo.</li>
<li>Se puede seguir la sugerencia de Django y añadir un <code>get_absolute_url</code> al modelo. Esta es una buena práctica que siempre se debe hacer. Establecer una URL canónica para un objeto, de modo que aunque la estructura de las URL cambie en el futuro, la referencia al objeto específico sea la misma.</li>
<li>En resumen, se debería añadir un método <code>get_absolute_url()</code> y <code>__str__()</code> a cada modelo que se escriba.</li>
</ul>
<p>FICHERO: <code>blog/models.py</code></p>
<pre><code class="language-python">from django.db import models
from django.urls import reverse


# Create your models here.
class Post(models.Model):
    title = models.CharField(
        'Título',
        max_length=200
    )
    author = models.ForeignKey(
        'auth.User',
        verbose_name='Autor',
        on_delete=models.CASCADE,
    )
    body = models.TextField(
        'Cuerpo'
    )

    def __str__(self):
        return self.title

    def get_absolute_url(self):
        return reverse('post_detail', args=[str(self.id)])

</code></pre>
<ul>
<li><code>reverse</code> es una función muy útil que Django proporciona para referirse a un objeto por el nombre de su plantilla URL, en este caso <code>post_detail</code>.</li>
</ul>
<pre><code class="language-python">path('post/&lt;int:pk&gt;/', views.BlogDetailView.as_view(), name='post_detail'),
</code></pre>
<ul>
<li>Eso significa que, para que esta ruta funcione, debemos pasar también como argumento la <code>pk</code> o clave primaria del objeto. A pesar de que <code>pk</code> e <code>id</code> son intercambiables en Django, la documentación de Django recomienda usar <code>self.id</code> con <code>get_absolute_url</code>.</li>
<li>Así le decimos a Django que la última ubicación de una entrada de un Post es su vista <code>post_detail</code> que es <code>posts/&lt;int:pk&gt;/</code> por lo que la ruta para la primera entrada que hemos hecho estará en <code>posts/1</code>.</li>
<li>Intentar crear una nueva entrada en el blog de nuevo en http://127.0.0.1:8000/post/new/ y se tendrá éxito al ser redirigido a la página de vista detallada donde aparece el post.</li>
<li>También se notará que la entrada anterior en el blog también está ahí. Fue enviada con éxito a la base de datos pero Django no supo cómo redirigirse después de eso.</li>
<li>Aunque se podría entrar en el administrador de Django para borrar los mensajes no deseados, es mejor añadir formularios para que un usuario pueda actualizar y eliminar los mensajes existentes directamente desde el sitio.</li>
</ul>
<h2 id="72-actualizar-formularios">7.2 Actualizar Formularios<a class="headerlink" href="#72-actualizar-formularios" title="Permanent link">¶</a></h2>
<ul>
<li>Para empezar, se añade un nuevo enlace a <code>post_detail.html</code> para que la opción de editar una entrada de blog aparezca en una página de blog individual.</li>
</ul>
<blockquote>
<p>Nota.- Si se sigue usando el contexto de la vista tal y como se dejó al final del tema anterior, se estará usando el contexto <code>anything_you_want</code> que <strong>habrá que eliminar</strong> para volver a usar los habituales <code>object</code>y <code>post</code>.</p>
</blockquote>
<p>FICHERO: <code>templates/post_detail.html</code></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block content %}
  &lt;div class="post-entry"&gt;
    &lt;h2&gt;{{ post.title }}&lt;/h2&gt;
    &lt;p&gt;{{ post.body }}&lt;/p&gt;
  &lt;/div&gt;

  &lt;a href="{% url 'post_edit' post.pk %}"&gt;+ Editar Post&lt;/a&gt;

{% endblock content %}
</code></pre>
<ul>
<li>Se ha  añadido un enlace usando <code>&lt;a href&gt;...&lt;/a&gt;</code> y la etiqueta del motor de plantillas de Django <code>{% url... %}</code>. Dentro de ella se ha especificado el nombre del objetivo de la url, que se llamará <code>post_edit</code>, y también se ha pasado el parámetro necesario, que es la clave principal del post <code>post.pk</code>.</li>
<li>A continuación se crea la plantilla para la página de edición llamada <code>post_edit.html</code>.</li>
</ul>
<p>FICHERO: <code>templates/post_edit.html</code></p>
<pre><code class="language-python">{% extends 'base.html' %}

{% block content %}
  &lt;h1&gt;Editar Post&lt;/h1&gt;
  &lt;form action="" method="post"&gt;
    {% csrf_token %}
    {{ form.as_p }}
    &lt;input type="submit" value="Actualizar" /&gt;
  &lt;/form&gt;
{% endblock content %}
</code></pre>
<ul>
<li>De nuevo se usan las etiquetas HTML <code>&lt;form&gt;&lt;/form&gt;</code>, el <code>csrf_token</code> de Django por seguridad, el <code>form.as_p</code> para mostrar los campos de formulario con etiquetas de párrafo, y finalmente se le da el valor "Update" en el botón <em>submit</em>.</li>
<li>Ahora a nuestra vista. Necesitamos importar <code>UpdateView</code> en la segunda línea superior y luego heredarla en nuestra nueva vista <code>BlogUpdateView</code>.
FICHERO: <code>blog/views.py</code></li>
</ul>
<pre><code class="language-python">from django.views.generic import ListView, DetailView
from django.views.generic.edit import CreateView, UpdateView
from .models import Post


class BlogListView(ListView):
    model = Post
    template_name = 'home.html'


class BlogDetailView(DetailView):
    model = Post
    template_name = 'post_detail.html'


class BlogCreateView(CreateView):
    model = Post
    template_name = 'post_new.html'
    fields = ['title', 'author', 'body']


class BlogUpdateView(UpdateView):
    model = Post
    fields = ['title', 'body']
    template_name = 'post_edit.html'
</code></pre>
<ul>
<li>Nótese que en <code>BlogUpdateView</code> se listan explícitamente los campos que se quieren usar <code>['title', 'body']</code> en lugar de usar utilizar también <code>'author'</code> ó simplemente <code>'__all__'</code> para así usar todos los campos de la tabla. Esto se debe a que se asume que el <em>autor</em> del post no cambia; sólo se quiere que el título y el texto sean editables.</li>
<li>El último paso es actualizar el archivo <code>urls.py</code> de la siguiente manera:</li>
</ul>
<p>FICHERO: <code>blog/urls.py</code></p>
<pre><code class="language-python">from django.urls import path
from .views import (
    BlogListView,
    BlogDetailView,
    BlogCreateView,
    BlogUpdateView,                                                             # new
)
urlpatterns = [
    path('post/&lt;int:pk&gt;/edit/', BlogUpdateView.as_view(), name='post_edit'),    # new
    path('post/new/', BlogCreateView.as_view(), name='post_new'),
    path('post/&lt;int:pk&gt;/', BlogDetailView.as_view(), name='post_detail'),
    path('', BlogListView.as_view(), name='home'),
]

</code></pre>
<ul>
<li>En la parte superior se agrega la vista <code>BlogUpdateView</code> a la lista de vistas importadas, luego se creará un nuevo patrón de url para <code>/post/pk/edit</code> y se le dará el nombre <code>post_edit</code>.</li>
<li>Ahora, si se hace click en una entrada del blog, se verá el nuevo botón <em>Editar</em>.</li>
<li>Si se hace clic en <em>"+ Editar Post"</em> se redirigirá a http://127.0.0.1:8000/post/1/edit/ si esa es la primera entrada en el blog.</li>
<li>Téngase en cuenta que el formulario está precargado con los datos existentes en la base de datos para el post.</li>
<li>
<p>Hagamos un cambio en el Post...</p>
</li>
<li>
<p>...y después de pulsar el botón "Actualizar" somos redirigidos a la vista de detalles del <em>post</em> en el que se puede ver el cambio. Esto se debe a la configuración <code>get_absolute_url</code>.</p>
</li>
<li>Si se navega a la página principal se podrá ver el cambio junto a todas las demás entradas.</li>
</ul>
<h2 id="73-borrar-la-vista">7.3 Borrar la vista<a class="headerlink" href="#73-borrar-la-vista" title="Permanent link">¶</a></h2>
<ul>
<li>El proceso de creación de un formulario para borrar entradas del blog es muy similar al de la actualización de un post.</li>
<li>Se usará otra vista genérica basada en clases, <code>DeleteView</code>, y se necesita crear una vista, una url y una plantilla para la funcionalidad.</li>
<li>Se comenzará por agregar un enlace para eliminar los post del blog en la página de blog individual, <code>post_detail.html</code>.</li>
</ul>
<p>FICHERO: <code>templates/post_detail.html</code></p>
<pre><code class="language-python">{% extends 'base.html' %}

{% block content %}
  &lt;div class="post-entry"&gt;
    &lt;h2&gt;{{ object.title }}&lt;/h2&gt;
    &lt;p&gt;{{ object.body }}&lt;/p&gt;
  &lt;/div&gt;

  &lt;p&gt;&lt;a href="{% url 'post_edit' post.pk %}"&gt;+ Editar Post&lt;/a&gt;&lt;/p&gt;
  &lt;p&gt;&lt;a href="{% url 'post_delete' post.pk %}"&gt;+ Borrar Post&lt;/a&gt;&lt;/p&gt;

{% endblock content %}
</code></pre>
<ul>
<li>A continuación, se crea un nuevo archivo para la plantilla de la página de borrado.</li>
</ul>
<p>FICHERO: <code>templates/post_delete.html</code></p>
<pre><code class="language-html">{% extends 'base.html' %}

{% block content %}
  &lt;h1&gt;Delete post&lt;/h1&gt;
  &lt;form action="" method="post"&gt;
    {% csrf_token %}
    &lt;p&gt;¿Seguro que quiere borrar "{{ post.title }}"?&lt;/p&gt;
    &lt;input type="submit" value="Confirmar" /&gt;
  &lt;/form&gt;
{% endblock content %}
</code></pre>
<blockquote>
<p>Nota</p>
<p>Se usa <code>post.title</code> para mostrar el título de la entrada en el blog. También se podría usar <code>object.title</code> ya que <code>DetailView</code> lo proporciona.
- Ahora se actualiza el archivo <code>views.py</code>, importando <code>DeleteView</code> y <code>reverse_lazy</code> en la parte superior, y luego creamos una nueva vista que hereda de <code>DeleteView</code>.</p>
</blockquote>
<p>FICHERO: <code>blog/views.py</code></p>
<pre><code class="language-python">from django.views.generic import ListView, DetailView
from django.views.generic.edit import (
    CreateView, UpdateView, DeleteView)                # new
from django.urls import reverse_lazy                   # new

from .models import Post

class BlogListView(ListView):
    model = Post
    template_name = 'home.html'


class BlogDetailView(DetailView):
    model = Post
    template_name = 'post_detail.html'


class BlogCreateView(CreateView):
    model = Post
    template_name = 'post_new.html'
    fields = ['title', 'author', 'body']


class BlogUpdateView(UpdateView):
    model = Post
    template_name = 'post_edit.html'
    fields = ['title', 'body']


class BlogDeleteView(DeleteView): # new
    model = Post
    template_name = 'post_delete.html'
    success_url = reverse_lazy('home')

</code></pre>
<ul>
<li>
<p>Se usa <code>reverse_lazy</code> en lugar de sólo <code>reverse</code> para que no ejecute la redirección URL hasta que la vista haya terminado de borrar la entrada del blog.</p>
</li>
<li>
<p>Finalmente agregar una url importando la vista <code>BlogDeleteView</code> y agregando un nuevo patrón:</p>
</li>
</ul>
<p>FICHERO: <code>blog/urls.py</code></p>
<pre><code class="language-python">from django.urls import path
from .views import (
    BlogListView,
    BlogDetailView,
    BlogCreateView,
    BlogUpdateView,
    BlogDeleteView, # new
)
urlpatterns = [
    path('post/&lt;int:pk&gt;/delete/', BlogDeleteView.as_view(), name='post_delete'),
    path('post/new/', BlogCreateView.as_view(), name='post_new'),
    path('post/&lt;int:pk&gt;/', BlogDetailView.as_view(), name='post_detail'),
    path('post/&lt;int:pk&gt;/edit/', BlogUpdateView.as_view(), name='post_edit'),
    path('', BlogListView.as_view(), name='home'),
]
</code></pre>
<h2 id="74-tests">7.4 Tests<a class="headerlink" href="#74-tests" title="Permanent link">¶</a></h2>
<ul>
<li>Se ha añadido un método <code>get_absolute_url</code> al modelo y nuevas vistas para crear, actualizar y editar entradas. Eso significa que se necesitan cuatro nuevas pruebas:</li>
<li><code>def test_get_absolute_url</code></li>
<li><code>def test_post_create_view</code></li>
<li><code>def test_post_update_view</code></li>
<li><code>def test_post_delete_view</code></li>
</ul>
<p>FICHERO: <code>blog/tests.py</code></p>
<pre><code class="language-python">from django.contrib.auth import get_user_model
from django.test import TestCase
from django.urls import reverse
from .models import Post


class BlogTests(TestCase):

    def setUp(self):
        self.user = get_user_model().objects.create_user(
            username='tester',
            email='test@email.com',
            password='secret'
        )
        self.post = Post.objects.create(
            title='A good title',
            body='Nice body content',
            author=self.user,
        )

    def test_string_representation(self):
        post = Post(title='A sample title')
        self.assertEqual(str(post), post.title)

    def test_get_absolute_url(self):
        self.assertEqual(self.post.get_absolute_url(), '/post/1/')

    def test_post_content(self):
        self.assertEqual(f'{self.post.title}', 'A good title')
        self.assertEqual(f'{self.post.author}', 'tester')
        self.assertEqual(f'{self.post.body}', 'Nice body content')

    def test_post_list_view(self):
        response = self.client.get(reverse('home'))
        self.assertEqual(response.status_code, 200)
        self.assertContains(response, 'Nice body content')
        self.assertTemplateUsed(response, 'home.html')

    def test_post_detail_view(self):
        response = self.client.get('/post/1/')
        no_response = self.client.get('/post/100000/')
        self.assertEqual(response.status_code, 200)
        self.assertEqual(no_response.status_code, 404)
        self.assertContains(response, 'A good title')
        self.assertTemplateUsed(response, 'post_detail.html')

    def test_post_create_view(self):
        response = self.client.post(reverse('post_new'),
                                    {
                                        'title': 'New title',
                                        'body': 'New text',
                                        'author': self.user.id,
                                    }
                                    )
        self.assertEqual(response.status_code, 302)
        self.assertEqual(Post.objects.last().title, 'New title')
        self.assertEqual(Post.objects.last().body, 'New text')

    def test_post_update_view(self):
        response = self.client.post(reverse('post_edit', args='1'),
                                    {
                                        'title': 'Updated title',
                                        'body': 'Updated text',
                                    }
                                    )
        self.assertEqual(response.status_code, 302)

    def test_post_delete_view(self):
        response = self.client.post(reverse('post_delete', args='1'))
        self.assertEqual(response.status_code, 302)

</code></pre>
<ul>
<li>Se espera que la url de la prueba esté en <code>post/1/</code> ya que sólo hay un post y el <code>1</code> es la clave primaria que Django añade automáticamente. Para testar la creación de la vista se crea una nueva respuesta y luego se asegura que se pase la respuesta (código de estado 200) y contenga nuestro el título y texto del cuerpo.</li>
<li>Para actualizar la vista, se accede al primer post que tiene un <code>pk</code> de <code>1</code> que se pasa como único argumento y confirmamos que resulta en una redirección 302.</li>
<li>Finalmente se prueba la vista de borrado confirmando que si eliminamos un post el código de estado es 302, una redirección daado que el ítem ya no existe.</li>
<li>Siempre hay más pruebas que pueden ser añadidas, pero esto al menos da cobertura a todas las nuevas funcionalidades.</li>
</ul>
<h2 id="75-conclusion">7.5 Conclusión<a class="headerlink" href="#75-conclusion" title="Permanent link">¶</a></h2>
<ul>
<li>En una pequeña cantidad de código se ha construido una aplicación de blog que permite crear, leer, actualizar y borrar entradas de blog. Esta funcionalidad básica se conoce por el acrónimo <em>CRUD: Create-Read-Update-Delete</em>. Aunque hay múltiples maneras de lograr esta misma funcionalidad -se podría haber usado vistas basadas en funciones o haber escrito unas vistas propias basadas en clases- se ha demostrado lo poco de código que se necesita en Django para conseguirlo.</li>
</ul>
<p>|\/| [- || <sub>|</sub> [- ( / <sub>|</sub> () ^/_ '|</p>
</article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.b78d2936.min.js"></script>
<script src="../../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</body>
</html>