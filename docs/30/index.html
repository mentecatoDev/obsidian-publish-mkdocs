
<!DOCTYPE html>

<html class="no-js" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1" name="viewport"/>
<link href="../27/" rel="prev"/>
<link href="../31/" rel="next"/>
<link href="../../assets/images/favicon.png" rel="icon"/>
<meta content="mkdocs-1.4.2, mkdocs-material-9.1.1" name="generator"/>
<title>30 - obsidian-mkdocs template</title>
<link href="../../assets/stylesheets/main.402914a4.min.css" rel="stylesheet"/>
<link href="../../assets/stylesheets/palette.a0c5b2b5.min.css" rel="stylesheet"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/>
<style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
<script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
</head>
<body data-md-color-accent="indigo" data-md-color-primary="pink" data-md-color-scheme="default" dir="ltr">
<script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
<input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/>
<input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/>
<label class="md-overlay" for="__drawer"></label>
<div data-md-component="skip">
<a class="md-skip" href="#bookstore_projectsettingspy">
          Skip to content
        </a>
</div>
<div data-md-component="announce">
</div>
<header class="md-header md-header--shadow" data-md-component="header">
<nav aria-label="Header" class="md-header__inner md-grid">
<a aria-label="obsidian-mkdocs template" class="md-header__button md-logo" data-md-component="logo" href="../.." title="obsidian-mkdocs template">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
<label class="md-header__button md-icon" for="__drawer">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"></path></svg>
</label>
<div class="md-header__title" data-md-component="header-title">
<div class="md-header__ellipsis">
<div class="md-header__topic">
<span class="md-ellipsis">
            obsidian-mkdocs template
          </span>
</div>
<div class="md-header__topic" data-md-component="header-topic">
<span class="md-ellipsis">
            
              30
            
          </span>
</div>
</div>
</div>
<form class="md-header__option" data-md-component="palette">
<input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="indigo" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="pink" data-md-color-scheme="default" id="__palette_1" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_2" hidden="" title="Switch to dark mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"></path></svg>
</label>
<input aria-label="Switch to light mode" class="md-option" data-md-color-accent="blue" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="pink" data-md-color-scheme="slate" id="__palette_2" name="__palette" type="radio"/>
<label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to light mode">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"></path></svg>
</label>
</form>
<label class="md-header__button md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
</label>
<div class="md-search" data-md-component="search" role="dialog">
<label class="md-search__overlay" for="__search"></label>
<div class="md-search__inner" role="search">
<form class="md-search__form" name="search">
<input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/>
<label class="md-search__icon md-icon" for="__search">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"></path></svg>
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"></path></svg>
</label>
<nav aria-label="Search" class="md-search__options">
<button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"></path></svg>
</button>
</nav>
</form>
<div class="md-search__output">
<div class="md-search__scrollwrap" data-md-scrollfix="">
<div class="md-search-result" data-md-component="search-result">
<div class="md-search-result__meta">
            Initializing search
          </div>
<ol class="md-search-result__list" role="presentation"></ol>
</div>
</div>
</div>
</div>
</div>
</nav>
</header>
<div class="md-container" data-md-component="container">
<main class="md-main" data-md-component="main">
<div class="md-main__inner md-grid">
<div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0">
<label class="md-nav__title" for="__drawer">
<a aria-label="obsidian-mkdocs template" class="md-nav__button md-logo" data-md-component="logo" href="../.." title="obsidian-mkdocs template">
<svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"></path></svg>
</a>
    obsidian-mkdocs template
  </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../..">
        Obsidian Notes
      </a>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_2" type="checkbox"/>
<label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Features
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_2_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_2">
<span class="md-nav__icon md-icon"></span>
          Features
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/LaTeX%20Math%20Support/">
        LaTeX Math Support
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/Mermaid%20Diagrams/">
        Mermaid diagrams
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Features/Text%20Formatting/">
        Text Formatting
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--nested">
<input class="md-nav__toggle md-toggle" id="__nav_3" type="checkbox"/>
<label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Topic 1
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="false" aria-labelledby="__nav_3_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_3">
<span class="md-nav__icon md-icon"></span>
          Topic 1
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../../Topic%201/Note%201/">
        Note 1
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../../Topic%201/Note%202/">
        Note 2
      </a>
</li>
</ul>
</nav>
</li>
<li class="md-nav__item md-nav__item--active md-nav__item--nested">
<input checked="" class="md-nav__toggle md-toggle" id="__nav_4" type="checkbox"/>
<label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Docs
          <span class="md-nav__icon md-icon"></span>
</label>
<nav aria-expanded="true" aria-labelledby="__nav_4_label" class="md-nav" data-md-level="1">
<label class="md-nav__title" for="__nav_4">
<span class="md-nav__icon md-icon"></span>
          Docs
        </label>
<ul class="md-nav__list" data-md-scrollfix="">
<li class="md-nav__item">
<a class="md-nav__link" href="../">
        Django
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../00_por_que_django/">
        ¿Por qué Django?
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../01_introduccion/">
        1 Introducción
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../02_configuracion_inicial/">
        2 Configuración inicial
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../03_hello_world_app/">
        3. Hello World
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../04_pages_app/">
        4 Pages app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../05_message_board_app/">
        5. Message Board app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../06_blog_app/">
        6. Blog app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../07_formularios/">
        7. Formularios
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../08_cuentas_de_usuarios/">
        8. Cuentas de Usuarios
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../09_modelo_de_usuario_personalizado/">
        9. Modelo de usuario personalizado
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../10_autenticacion_de_usuarios/">
        10. Autenticación de usuarios
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../11_bootstrap/">
        11. Bootstrap
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../12_cambio_y_restauracion_de_contrasenas/">
        12. Cambio y Restauración de Contraseñas
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../13_email/">
        13. Correo electrónico
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../14_newspaper_app/">
        14. Newspaper app
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../15_permisos_y_autorizacion/">
        15. Permisos y Autorización
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../16_comentarios/">
        16. Comentarios
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../17_docker/">
        17. Docker
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../18_postgresql/">
        18. PostgreSQL
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../19_/">
        19. Proyecto Bookstore
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../20_/">
        Chapter 4: Pages App
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../21/">
        21
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../22/">
        22
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../23/">
        23
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../24/">
        24
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../25/">
        25
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../26/">
        26
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../27/">
        27
      </a>
</li>
<li class="md-nav__item md-nav__item--active">
<input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/>
<a class="md-nav__link md-nav__link--active" href="./">
        30
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../31/">
        31
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../32/">
        32
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../33/">
        33
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../34/">
        34
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../35/">
        35
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../36/">
        36
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../conclusion/">
        Conclusión
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../correo_en_django/">
        Documentación Django
      </a>
</li>
<li class="md-nav__item">
<a class="md-nav__link" href="../la_api_de_sendgrid/">
        La API de SendGrid
      </a>
</li>
</ul>
</nav>
</li>
</ul>
</nav>
</div>
</div>
</div>
<div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc">
<div class="md-sidebar__scrollwrap">
<div class="md-sidebar__inner">
<nav aria-label="Table of contents" class="md-nav md-nav--secondary">
</nav>
</div>
</div>
</div>
<div class="md-content" data-md-component="content">
<article class="md-content__inner md-typeset">
<p>Chapter 12: File/Image Uploads
We previously configured static assets such as images in Chapter 6, but user-
uploaded files, such as book covers, are somewhat different. To start with, Django
refers to the former as static whereas anything uploaded by a user, whether it be a
file or an image, is referred to as media.
The process for adding this feature for files or images is similar, but for images the
Python image processing library Pillow210 must be installed which includes additional
features such as basic validation.
Let’s install pillow using our by-now-familiar pattern of installing it within Docker,
stopping our containers, and forcing a build of the new image.
Command Line
$ docker-compose exec web pipenv install pillow==6.2.1
$ docker-compose down
$ docker-compose up -d --build
Media Files
Fundamentally the difference between static and media files is that we can trust the
former, but we definitely can’t trust the latter by default. There are always security
concerns211 when dealing with user-uploaded content212. Notably, it’s important to
validate all uploaded files to ensure they are what they say they are. There are a
210 https://python-pillow.org/
211 https://docs.djangoproject.com/en/2.2/ref/models/fields/#file-upload-security
212 https://docs.djangoproject.com/en/2.2/topics/security/#user-uploaded-content
Chapter 12: File/Image Uploads
 235
number of nasty ways a malicious actor can attack a website that blindly accepts user
uploads.
To start let’s add two new configurations to the bookstore_project/settings.py file.
By default MEDIA_URL and MEDIA_ROOT are empty and not displayed so we need to
configure them:
• MEDIA_ROOT213 is the absolute file system path to the directory for user-
uploaded files
• MEDIA_URL214 is the URL we can use in our templates for the files
For convenience lump the static and media file configurations together so add both
of these settings after STATICFILES_FINDERS near the bottom of the file. We’ll use the
common convention of calling both media. Don’t forget to include the trailing slash /
for MEDIA_URL!
Code</p>
<h1 id="bookstore_projectsettingspy">bookstore_project/settings.py<a class="headerlink" href="#bookstore_projectsettingspy" title="Permanent link">¶</a></h1>
<p>MEDIA_URL = '/media/' # new
MEDIA_ROOT = os.path.join(BASE_DIR, 'media') # new
Next add a new directory called media and a subdirectory called covers within it.
Command Line
$ mkdir media
$ mkdir media/covers
And finally since user-uploaded content is assumed to exist in a production context,
to see media items locally we need to update bookstore_project/urls.py to show the
files locally. This involves importing both settings and static at the top and then
adding an additional line at the bottom.
213 https://docs.djangoproject.com/en/2.2/ref/settings/#media-root
214 https://docs.djangoproject.com/en/2.2/ref/settings/#media-url
Chapter 12: File/Image Uploads
Code</p>
<h1 id="bookstore_projecturlspy">bookstore_project/urls.py<a class="headerlink" href="#bookstore_projecturlspy" title="Permanent link">¶</a></h1>
<p>from django.conf import settings # new
from django.conf.urls.static import static # new
from django.contrib import admin
from django.urls import path, include
urlpatterns = [</p>
<h1 id="django-admin">Django admin<a class="headerlink" href="#django-admin" title="Permanent link">¶</a></h1>
<p>path('admin/', admin.site.urls),
236</p>
<h1 id="user-management">User management<a class="headerlink" href="#user-management" title="Permanent link">¶</a></h1>
<p>path('accounts/', include('allauth.urls')),</p>
<h1 id="local-apps">Local apps<a class="headerlink" href="#local-apps" title="Permanent link">¶</a></h1>
<p>path('', include('pages.urls')),
path('books/', include('books.urls')),
] + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT) # new
Models
With our generic media configuration out of the way we can now turn to our models.
To store these images we’ll use Django’s ImageField215 which comes with some basic
image processing validation included.
The name of the field is cover and we specify the location of the uploaded image will be
in MEDIA_ROOT/covers (the MEDIA_ROOT part is implied based on our earlier settings.py
config).
215 https://docs.djangoproject.com/en/2.2/ref/models/fields/#django.db.models.ImageField
Chapter 12: File/Image Uploads
Code</p>
<h1 id="booksmodelspy">books/models.py<a class="headerlink" href="#booksmodelspy" title="Permanent link">¶</a></h1>
<p>class Book(models.Model):
id = models.UUIDField(
primary_key=True,
default=uuid.uuid4,
editable=False)
title = models.CharField(max_length=200)
author = models.CharField(max_length=200)
price = models.DecimalField(max_digits=6, decimal_places=2)
cover = models.ImageField(upload_to='covers/') # new
def__str__(self):
return self.title
def get_absolute_url(self):
return reverse('book_detail', kwargs={'pk': str(self.pk)})
237
If we wanted to allow uploads of a regular file rather than an image file the only
difference could be to change ImageField to FileField.
Since we’ve updated the model it’s time to create a migrations file.
Chapter 12: File/Image Uploads
 238
Command Line
$ docker-compose exec web python manage.py makemigrations books
You are trying to add a non-nullable field 'cover_image' to book
without a default; we can't do that (the database needs something to populate
existing rows).
Please select a fix:
1) Provide a one-off default now (will be set on all existing rows with a
null value for this column)
2) Quit, and let me add a default in models.py
Select an option:
Oops! What happened? We’re adding a new database field, but we already have three
entries in our database for each book. Yet we failed to set a default value for cover.
To fix this type 2 to quit and we’ll add a blank216 field set to True for existing images.
Code</p>
<h1 id="bookstore_projectmodelspy">bookstore_project/models.py<a class="headerlink" href="#bookstore_projectmodelspy" title="Permanent link">¶</a></h1>
<p>cover = models.ImageField(upload_to='covers/', blank=True) # new
It’s common to see blank and nulla used together to set a default value on a field. A
gotcha is that the field type – ImageField vs. CharField and so on – dictates how to use
them properly so closely read the documentation for future use.
ahttps://docs.djangoproject.com/en/2.2/ref/models/fields/#null
Now we can create a migrations file without errors.
216 https://docs.djangoproject.com/en/2.2/ref/models/fields/#blank
Chapter 12: File/Image Uploads
Command Line
$ docker-compose exec web python manage.py makemigrations books
Migrations for 'books':
books/migrations/0003_book_cover.py
- Add field cover to book
239
And then apply the migration to our database.
Command Line
$ docker-compose exec web python manage.py migrate
Operations to perform:
Apply all migrations: account, admin, auth, books, contenttypes, reviews, ses
sions, sites, users
Running migrations:
Applying books.0003_book_cover... OK
Admin
We’re in the home stretch now! Navigate over to the admin and to the entry for the
book “Django for Professionals.” The cover field is visible already and we already have
a copy of it locally within static/images/djangoforprofessionals.jpg so use that file
for the upload and then click the “Save” button in bottom right.
Chapter 12: File/Image Uploads
 240
Admin add cover
This will redirect back to the main Books section. Click on the link again for “Django
for Profesionals” and we can see it currently exists in our desired location of covers/.
Chapter 12: File/Image Uploads
 241
Admin with cover
Template
OK, final step. Let’s update our template to display the book cover on the individual
page. The route will be book.cover.url pointing to the location of the cover in our file
system.
Chapter 12: File/Image Uploads
 242
Here’s what the updated book_detail.html file looks like with this one line change
above the title.
Code</p>
<h1 id="templatesbooksbook_detailhtml">templates/books/book_detail.html<a class="headerlink" href="#templatesbooksbook_detailhtml" title="Permanent link">¶</a></h1>
<p>{% extends '_base.html' %}
{% block title %}{{ book.title }}{% endblock title %}
{% block content %}</p>
<div class="book-detail">
<img alt="{{ book.title }}" class="bookcover" src="{{ book.cover.url}}"/>
<h2><a href="">{{ book.title }}</a></h2>
<p>Author: {{ book.author }}</p>
<p>Price: {{ book.price }}</p>
<div>
<h3>Reviews</h3>
<ul>
{% for review in book.reviews.all %}
<li>{{ review.review }} ({{ review.author }})</li>
{% endfor %}
</ul>
</div>
</div>
<p>{% endblock content %}
If you now visit the page for “Django for Professionals” you’ll see the cover image
proudly there!
Chapter 12: File/Image Uploads
 243
Cover image
One potential gotcha is that our template now expects a cover to be present. If you
navigate to either of the two other books, for which we have not added a cover, you’ll
see the following error message.
Chapter 12: File/Image Uploads
 244
Cover image error
We must add some basic logic to our template so that if a cover is not present the
template doesn’t look for it! This can be done using an if statement that checks for
book.cover and displays it if it exists.
Code</p>
<h1 id="templatesbooksbook_detailhtml_1">templates/books/book_detail.html<a class="headerlink" href="#templatesbooksbook_detailhtml_1" title="Permanent link">¶</a></h1>
<p>{% extends '_base.html' %}
{% block title %}{{ book.title }}{% endblock title %}
{% block content %}</p>
<div class="book-detail">
{% if book.cover %}
<img alt="{{ book.title }}" class="bookcover" src="{{ book.cover.url}}"/>
{% endif %}
<p>Author: {{ book.author }}</p>
Chapter 12: File/Image Uploads
 245
...
If you refresh either book page now you’ll see they display the correct page albeit
without a cover.
Next Steps
There are several additional steps that might be nice to take in a project, but are
beyond the scope of this book. These include adding dedicated create/edit/delete
forms for the creation of books and cover image. A quite lengthy list of extra
validations can and should be placed on the image-uploading form to ensure that
only a normal image is added to the database.
A further step would be to store media files in a dedicated CDN (Content Delivery
Network) for additional security. This can also be helpful for performance on very
large sites for static files, but for media files is a good idea regardless of the size.
Finally tests would be nice to have here although they would be primarily focused on
the form validation section, not the basic image-uploading via the admin. Again this
is an area that can become quite complex, but is worthy of further study.
Git
Make sure to create a new Git commit for the changes in this chapter.
Chapter 12: File/Image Uploads
 246
Command Line
$ git status
$ git add .
$ git commit -m 'ch12'
As always you can compare your code against the official source code on Github217 .
Conclusion
This chapter demonstrated how to add user files to a project. In practice it is
straightforward, but the additional layer of security concerns makes it an area worthy
of focus at scale.
In the next chapter we will add permissions to our site to lock it down.
217 https://github.com/wsvincent/djangoforprofessionals/tree/master/ch12-file-image-uploads





                
              </div></article>
</div>
</div>
</main>
<footer class="md-footer">
<div class="md-footer-meta md-typeset">
<div class="md-footer-meta__inner md-grid">
<div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank">
      Material for MkDocs
    </a>
</div>
</div>
</div>
</footer>
</div>
<div class="md-dialog" data-md-component="dialog">
<div class="md-dialog__inner md-typeset"></div>
</div>
<script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
<script src="../../assets/javascripts/bundle.b78d2936.min.js"></script>
<script src="../../javascripts/mathjax.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
</body>
</html>